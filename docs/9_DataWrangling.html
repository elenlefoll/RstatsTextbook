<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Elen Le Foll">

<title>9&nbsp; Data wRangling – Data Analysis for the Language Sciences</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./10_Dataviz.html" rel="next">
<link href="./8_DescriptiveStats.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-53f539a478d6ecd1be31ce9fd30fd81c.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-3e3370d44295d9fa30cc16d77ad785c2.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-53f539a478d6ecd1be31ce9fd30fd81c.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-db8da973c8974479654007bb7dceba98.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-540c66f2be59a33d43b8e94dc657d4ab.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-db8da973c8974479654007bb7dceba98.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
.cell-output-stdout code {
  word-break: break-wor !important;
  white-space: pre-wrap !important;
}
</style>


<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating slimcontent quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    window.setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      window.setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    window.hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(darkModeDefault) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const darkModeDefault = false;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !window.hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
    };
    // Switch to dark mode if need be
    if (window.hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./9_DataWrangling.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data w<code>R</code>angling</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Analysis for the<br>Language Sciences</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="mailto:elefoll@uni-koeln.de" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-envelope"></i></a>
    <a href="https://github.com/elenlefoll/RstatsTextbook/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_OpenScholarship.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Open Scholarship</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_Data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data files and formats</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_DataManagement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data management</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_InstallingR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Installing <code>R</code> and RStudio</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_GettingStaRted.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Getting sta<code>R</code>ted in <code>R</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6_ImpoRtingData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Impo<code>R</code>ting data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7_VariablesFunctions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Va<code>R</code>iables and functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8_DescriptiveStats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Desc<code>R</code>iptive statistics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9_DataWrangling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data w<code>R</code>angling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_Dataviz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The Gramma<code>R</code> of Graphics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_Inferential.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Infe<code>R</code>ential statistics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_SimpleLinearRegression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Int<code>R</code>oduction to statistical modelling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_MultipleLinearRegression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multiple linear reg<code>R</code>ession modelling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_LiterateProgramming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Rep<code>R</code>oducible research and academic w<code>R</code>iting in Quarto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_PartingWords.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Resea<code>R</code>ching with AI?</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A_FurtherResources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Next-step resources</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Case studies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./B_CaseStudies/Poppy/ThrowVerbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">‘Throw’ verbs in Spanish: Rep<code>R</code>oducing the results of a corpus linguistics study</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./B_CaseStudies/Rose-Gina/Emojis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">The semantics of emojis: Explo<code>R</code>ing the results of an experimental study</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./B_CaseStudies/Dela/Perdon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">The g<code>R</code>ammaticalization of ‘perdón’ in Spanish varieties</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#chapter-overview" id="toc-chapter-overview" class="nav-link active" data-scroll-target="#chapter-overview">Chapter overview</a></li>
  <li><a href="#sec-tidyverse" id="toc-sec-tidyverse" class="nav-link" data-scroll-target="#sec-tidyverse"><span class="header-section-number">9.1</span> Welcome to the tidyverse! 🪐</a></li>
  <li><a href="#sec-Conflicts" id="toc-sec-Conflicts" class="nav-link" data-scroll-target="#sec-Conflicts"><span class="header-section-number">9.2</span> Base <code>R</code> vs.&nbsp;tidyverse functions</a></li>
  <li><a href="#sec-Sanity" id="toc-sec-Sanity" class="nav-link" data-scroll-target="#sec-Sanity"><span class="header-section-number">9.3</span> Checking data sanity</a>
  <ul class="collapse">
  <li><a href="#sec-CheckNumeric" id="toc-sec-CheckNumeric" class="nav-link" data-scroll-target="#sec-CheckNumeric"><span class="header-section-number">9.3.1</span> Numeric variables</a></li>
  <li><a href="#sec-Factors" id="toc-sec-Factors" class="nav-link" data-scroll-target="#sec-Factors"><span class="header-section-number">9.3.2</span> Categorical variables as factors</a></li>
  </ul></li>
  <li><a href="#sec-Preprocessing" id="toc-sec-Preprocessing" class="nav-link" data-scroll-target="#sec-Preprocessing"><span class="header-section-number">9.4</span> Pre-processing data</a>
  <ul class="collapse">
  <li><a href="#sec-mutate" id="toc-sec-mutate" class="nav-link" data-scroll-target="#sec-mutate"><span class="header-section-number">9.4.1</span> Using <code>mutate()</code> to add and replace columns</a></li>
  <li><a href="#sec-across" id="toc-sec-across" class="nav-link" data-scroll-target="#sec-across"><span class="header-section-number">9.4.2</span> Using <code>across()</code> to transform multiple columns</a></li>
  </ul></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning"><span class="header-section-number">9.5</span> Data cleaning 🧼</a>
  <ul class="collapse">
  <li><a href="#sec-stringR" id="toc-sec-stringR" class="nav-link" data-scroll-target="#sec-stringR"><span class="header-section-number">9.5.1</span> Using {stringr} functions</a></li>
  <li><a href="#sec-casewhen" id="toc-sec-casewhen" class="nav-link" data-scroll-target="#sec-casewhen"><span class="header-section-number">9.6.4</span> Using <code>case_when()</code></a></li>
  </ul></li>
  <li><a href="#sec-CombiningDatasets" id="toc-sec-CombiningDatasets" class="nav-link" data-scroll-target="#sec-CombiningDatasets"><span class="header-section-number">9.7</span> Combining datasets</a></li>
  <li><a href="#sec-filter" id="toc-sec-filter" class="nav-link" data-scroll-target="#sec-filter"><span class="header-section-number">9.8</span> A pre-processing pipeline</a></li>
  <li><a href="#sec-ExportingRObjects" id="toc-sec-ExportingRObjects" class="nav-link" data-scroll-target="#sec-ExportingRObjects"><span class="header-section-number">9.9</span> Saving and exporting <code>R</code> objects</a></li>
  <li><a href="#check-your-progress" id="toc-check-your-progress" class="nav-link" data-scroll-target="#check-your-progress">Check your progress 🌟</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-DataWrangling" class="quarto-section-identifier"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data w<code>R</code>angling</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="chapter-overview" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="chapter-overview">Chapter overview</h3>
<p>In this chapter, you will learn how to:</p>
<ul>
<li>Recognise whether a dataset is in a tidy data format</li>
<li>Check the sanity of an imported dataset</li>
<li>Pre-process data in a reproducible way using tidyverse functions</li>
<li>Convert character vectors representing categorical data to factors</li>
<li>Add and replace columns in a table</li>
<li>Transform several columns of a table at once</li>
<li>Use {stringr} functions to manipulate text values</li>
<li>Reshape and combine tables</li>
<li>Save and export <code>R</code> objects in different formats</li>
</ul>
</section>
<section id="sec-tidyverse" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="sec-tidyverse"><span class="header-section-number">9.1</span> Welcome to the tidyverse! 🪐</h2>
<p>This chapter explains how to examine, clean, and manipulate data mostly using functions from the <a href="https://www.tidyverse.org">{tidyverse}</a>: a collection of useful <code>R</code> packages increasingly used for all kinds of data analysis projects. Tidyverse functions are designed to work with <strong>tidy data</strong> (see <a href="#fig-tidydata" class="quarto-xref">Figure&nbsp;<span>9.1</span></a>) and, as a result, they are often easier to combine.</p>
<div id="fig-tidydata" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Stylized text providing an overview of Tidy Data. The top reads “Tidy data is a standard way of mapping the meaning of a dataset to its structure. - Hadley Wickham.” On the left reads “In tidy data: each variable forms a column; each observation forms a row; each cell is a single measurement.” There is an example table on the lower right with columns ‘id’, ‘name’ and ‘color’ with observations for different cats, illustrating tidy data structure.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tidydata-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/AHorst_tidydata.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;9.1: Tidy data illustration from the Openscapes blog Tidy Data for reproducibility, efficiency, and collaboration by @horstOpenscapesTidyData2020."><img src="images/AHorst_tidydata.jpg" class="img-fluid figure-img" alt="Stylized text providing an overview of Tidy Data. The top reads “Tidy data is a standard way of mapping the meaning of a dataset to its structure. - Hadley Wickham.” On the left reads “In tidy data: each variable forms a column; each observation forms a row; each cell is a single measurement.” There is an example table on the lower right with columns ‘id’, ‘name’ and ‘color’ with observations for different cats, illustrating tidy data structure."></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidydata-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.1: Tidy data illustration from the <a href="https://www.openscapes.org/">Openscapes</a> blog <a href="https://www.openscapes.org/blog/2020/10/12/tidy-data/">Tidy Data for reproducibility, efficiency, and collaboration</a> by <span class="citation" data-cites="horstOpenscapesTidyData2020">Horst &amp; Lowndes (<a href="99_references.html#ref-horstOpenscapesTidyData2020" role="doc-biblioref">2020</a>)</span>.
</figcaption>
</figure>
</div>
<p>Learning to manipulate data and conduct data analysis in <code>R</code> “the tidyverse-way” can help make your workflows more efficient.</p>
<blockquote class="blockquote">
<p>If you ensure that your data are tidy, you’ll spend less time fighting with the tools and more time working on your analysis. <span class="citation" data-cites="TidyMessyData">(<a href="99_references.html#ref-TidyMessyData" role="doc-biblioref">Wickham, Vaughan &amp; Girlich</a>)</span></p>
</blockquote>
</section>
<section id="sec-Conflicts" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="sec-Conflicts"><span class="header-section-number">9.2</span> Base <code>R</code> vs.&nbsp;tidyverse functions</h2>
<p>Novice <code>R</code> users may find it confusing that many operations can be performed using either a base <code>R</code> function or a tidyverse one. For example, in <a href="6_ImpoRtingData.html" class="quarto-xref"><span>Chapter 6</span></a>, we saw that both the base <code>R</code> function <code>read.csv()</code> and the tidyverse function <code>read_csv()</code> can be used to import CSV files. The functions have slightly different arguments and default values, which can be annoying, even though they are fundamentally designed to perform the same task. But don’t fret over this too much: it’s fine for you to use whichever function you find most convenient and intuitive and it’s also absolutely fine to combine base <code>R</code> and tidyverse functions!</p>
<p>You will no doubt have noticed that the functions <code>read.csv()</code> and <code>read_csv()</code> have very similar but not exactly identical names. This is helpful to differentiate between the two functions. Unfortunately, some function names are found in several packages, which can lead to confusion and errors! For example, you may have noticed that when you load the tidyverse library the first time in a project, a message similar to <a href="#fig-tidyverseConflicts" class="quarto-xref">Figure&nbsp;<span>9.2</span></a> is printed in the Console.</p>
<div id="fig-tidyverseConflicts" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Screenshot of R Console showing the output of the command library(tidyverse). The output lists all attached core tidyverse packages and their versions and then it lists &quot;Conflicts: tidyverse_conflicts() ── ✖ dplyr::filter() masks stats::filter() ✖ dplyr::lag()    masks stats::lag() ℹ Use the conflicted package to force all conflicts to become errors&quot;">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tidyverseConflicts-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/TidyverseConflicts.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;9.2: Screenshot of the R Console after having loaded the {tidyverse} library"><img src="images/TidyverseConflicts.png" class="img-fluid figure-img" alt="Screenshot of R Console showing the output of the command library(tidyverse). The output lists all attached core tidyverse packages and their versions and then it lists &quot;Conflicts: tidyverse_conflicts() ── ✖ dplyr::filter() masks stats::filter() ✖ dplyr::lag()    masks stats::lag() ℹ Use the conflicted package to force all conflicts to become errors&quot;" width="516"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidyverseConflicts-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.2: Screenshot of the <code>R</code> Console after having loaded the {tidyverse} library
</figcaption>
</figure>
</div>
<p>First, the error message reproduced in <a href="#fig-tidyverseConflicts" class="quarto-xref">Figure&nbsp;<span>9.2</span></a> confirms that loading the {tidyverse} package has led to the successful loading of a total of nine packages and that these are now ready to use. Crucially, the message also warns us about <strong>conflicts</strong> between some {tidyverse} packages and base <code>R</code> packages. These conflicts are due to the fact that two functions from the {dplyr} package have exactly the same name as functions from the base <code>R</code> {stats} package. The warning informs us that, by default, the {dplyr} functions will be applied.</p>
<p>To force <code>R</code> to use a function from a specific package, we can use the <code>package::function()</code> syntax. Hence, to force <code>R</code> to use the base <code>R</code> {stats} <code>filter()</code> function rather than the tidyverse one, we would use <code>stats::filter()</code>. On the contrary, if we want to be absolutely certain that the tidyverse one is used, we can use <code>dplyr::filter()</code>.</p>
<div id="fig-tidyverse" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Hexagonal stickers flying in space. The stickers all represent tidyverse packages including stringr, tidyr, readr, tibble, and dyplr.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tidyverse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/AHorst_tidyverse.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;9.3: A galaxy of tidyverse-related hex stickers (artwork by @allison_horst)."><img src="images/AHorst_tidyverse.png" class="img-fluid figure-img" alt="Hexagonal stickers flying in space. The stickers all represent tidyverse packages including stringr, tidyr, readr, tibble, and dyplr." width="300"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidyverse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.3: A galaxy of tidyverse-related hex stickers (artwork by <a href="https://allisonhorst.com/allison-horst">@allison_horst</a>).
</figcaption>
</figure>
</div>
<p>In this chapter, we will explore functions from {<a href="https://dplyr.tidyverse.org/">dplyr</a>}, {<a href="https://stringr.tidyverse.org/">stringr</a>}, and {<a href="https://tidyr.tidyverse.org/">tidyr</a>}. The popular {<a href="https://ggplot2.tidyverse.org/">ggplot2</a>} tidyverse library for data visualisation following the “Grammar of Graphics” approach will be introduced in <a href="@sec-DataViz">Chapter 10</a>. Make sure that you have loaded the tidyverse packages before proceeding with the rest of this chapter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-Sanity" class="level2 page-columns page-full" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="sec-Sanity"><span class="header-section-number">9.3</span> Checking data sanity</h2>
<p>Before beginning any data analysis, it is important to always check the sanity of our data. In the following, we will use tables and descriptive statistics to do this. In <a href="@sec-DataViz">Chapter 10</a>, we will learn how to use data visualisation to check for outliers and other issues that may affect our analyses.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prerequisites
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>In this chapter and the following chapters, all examples, tasks, and quiz questions are based on data from:</p>
<blockquote class="blockquote">
<p>Dąbrowska, Ewa. 2019. Experience, Aptitude, and Individual Differences in Linguistic Attainment: A Comparison of Native and Nonnative Speakers. Language Learning 69(S1). 72–100. <a href="https://doi.org/10.1111/lang.12323" class="uri">https://doi.org/10.1111/lang.12323</a>.</p>
</blockquote>
<p>You will only be able to reproduce the analyses and answer the quiz questions from this chapter if you have created an RProject and successfully imported the two datasets from <span class="citation" data-cites="DabrowskaExperienceAptitudeIndividual2019">Dąbrowska (<a href="99_references.html#ref-DabrowskaExperienceAptitudeIndividual2019" role="doc-biblioref">2019</a>)</span> into your local <code>R</code> environment (see <a href="7_VariablesFunctions.html#fig-DataLoaded" class="quarto-xref">Figure&nbsp;<span>7.1</span></a>). Detailed instructions to do so can be found from <a href="6_ImpoRtingData.html#sec-RProject" class="quarto-xref"><span>Section 6.3</span></a> to <a href="6_ImpoRtingData.html#sec-ImportingDataCSV" class="quarto-xref"><span>Section 6.5</span></a>.</p>
<p>Alternatively, you can download <code>Dabrowska2019.zip</code> from <a href="https://github.com/elenlefoll/RstatsTextbook/raw/69d1e31be7394f2b612825f031ebffeb75886390/Dabrowska2019.zip" class="uri">the textbook’s GitHub repository</a>. To launch the project correctly, first unzip the file and then double-click on the <code>Dabrowska2019.Rproj</code> file.</p>
</div>
</div>
</div>
<p>Before we get started, make sure that both the L1 and the L2 datasets are correctly loaded by checking the structure of the <code>R</code> objects using the <code>str()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>L1.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"L1_data.csv"</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(L1.data)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>L2.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"L2_data.csv"</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(L2.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sec-CheckNumeric" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1" class="anchored" data-anchor-id="sec-CheckNumeric"><span class="header-section-number">9.3.1</span> Numeric variables</h3>
<p>In <a href="8_DescriptiveStats.html#sec-IQR" class="quarto-xref"><span>Section 8.3.2</span></a>, we used the <code>summary()</code> function to obtain some useful descriptive statistics on a single numeric variable, namely the range, mean, median, and interquartile range (IQR).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(L1.data<span class="sc">$</span>GrammarR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  58.00   71.25   76.00   74.42   79.00   80.00 </code></pre>
</div>
</div>
<p>To check the sanity of a dataset, we can use this same function on an entire data table (provided that the data are in the tidy format, see <a href="#sec-tidyverse" class="quarto-xref"><span>Section 9.1</span></a>). Thus, the command <code>summary(L1.data)</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> outputs summary statistics on all the variables of the L1 dataset - in other words, on all the columns of the data frame <code>L1.data</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(L1.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> Participant             Age           Gender           Occupation       
 Length:90          Min.   :17.00   Length:90          Length:90         
 Class :character   1st Qu.:25.00   Class :character   Class :character  
 Mode  :character   Median :32.00   Mode  :character   Mode  :character  
                    Mean   :37.54                                        
                    3rd Qu.:55.00                                        
                    Max.   :65.00                                        
  OccupGroup          OtherLgs          Education             EduYrs     
 Length:90          Length:90          Length:90          Min.   :10.00  
 Class :character   Class :character   Class :character   1st Qu.:12.00  
 Mode  :character   Mode  :character   Mode  :character   Median :13.00  
                                                          Mean   :13.71  
                                                          3rd Qu.:14.00  
                                                          Max.   :21.00  
    ReadEng1        ReadEng2        ReadEng3        ReadEng      
 Min.   :0.000   Min.   :0.000   Min.   :0.000   Min.   : 0.000  
 1st Qu.:1.000   1st Qu.:1.000   1st Qu.:2.000   1st Qu.: 5.000  
 Median :2.000   Median :2.000   Median :2.000   Median : 7.000  
 Mean   :2.522   Mean   :2.433   Mean   :2.233   Mean   : 7.189  
 3rd Qu.:3.000   3rd Qu.:3.000   3rd Qu.:3.000   3rd Qu.: 9.750  
 Max.   :5.000   Max.   :5.000   Max.   :4.000   Max.   :14.000  </code></pre>
</div>
</div>
<p>For the numeric variables in the dataset, the <code>summary()</code> function provides us with many useful descriptive statistics to check the sanity of the data. For example, we can check whether the minimum values include improbably low values (e.g., a five-year-old participant in a written language exam) or outright impossible ones (e.g., a minus 18-year old participant!). Equally, if we know that the maximum number of points that could be obtained in the English grammar test is 100, a maximum value of more than 100 would be highly suspicious and warrant further investigation.</p>
<p>As far as we can see from the output of <code>summary(L1.data)</code> above, the numeric variables in <span class="citation" data-cites="DabrowskaExperienceAptitudeIndividual2019">Dąbrowska (<a href="99_references.html#ref-DabrowskaExperienceAptitudeIndividual2019" role="doc-biblioref">2019</a>)</span>’s L1 dataset do not appear to feature any obvious problematic values.</p>
</section>
<section id="sec-Factors" class="level3 page-columns page-full" data-number="9.3.2">
<h3 data-number="9.3.2" class="anchored" data-anchor-id="sec-Factors"><span class="header-section-number">9.3.2</span> Categorical variables as factors</h3>
<p>Having examined the numeric variables, we now turn to the non-numeric, categorical ones (see <a href="7_VariablesFunctions.html#sec-Variables" class="quarto-xref"><span>Section 7.2</span></a>). For these variables, the descriptive statistics returned by <code>summary(L1.data)</code> are not as insightful. They only tell us that they each include 90 values, which corresponds to the 90 participants in the L1 dataset. As we can see from the output of the <code>str()</code> function, these categorical variables are stored in <code>R</code> as character string vectors (abbreviated in the <code>str()</code> output to “chr”).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(L1.data<span class="sc">$</span>Gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> chr [1:90] "M" "M" "M" "F" "F" "F" "F" "M" "M" "F" "F" "M" "M" "F" "M" "F" ...</code></pre>
</div>
</div>
<p>Character string vectors are a useful <code>R</code> object type for text but, in <code>R</code>, categorical variables are best stored as factors. Factors are a more efficient way to store character values because each unique character value is stored only once. The data itself are stored as a vector of integers. Let’s look at an example.</p>
<p>First, we convert the categorical variable <code>Gender</code> from <code>L1.data</code> that is currently stored as a character string vector to a factor vector called <code>L1.Gender.fct</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>L1.Gender.fct <span class="ot">&lt;-</span> <span class="fu">factor</span>(L1.data<span class="sc">$</span>Gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When we now inspect its structure using <code>str()</code>, we can see that <code>L1.Gender.fct</code> is a factor with two levels “F” and “M”. The values themselves, however, are no longer listed as “M” “M” “M” “F” “F”…, but rather as integers: 2 2 2 1 1 1….</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(L1.Gender.fct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> Factor w/ 2 levels "F","M": 2 2 2 1 1 1 1 2 2 1 ...</code></pre>
</div>
</div>
<p>By default, the levels of a factor are ordered alphabetically, hence in <code>L1.Gender.fct</code>, 1 corresponds to “F” and 2 to “M”.</p>
<p>The summary output of factor vectors are far more insightful than of character variables (and look rather like the output of the <code>table()</code> function that we used in <a href="8_DescriptiveStats.html#sec-Mode" class="quarto-xref"><span>Section 8.1.3</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(L1.Gender.fct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> F  M 
48 42 </code></pre>
</div>
</div>
<p>The tidyverse package <a href="https://forcats.tidyverse.org/">{forcats}</a> has a lot of very useful functions to manipulate factors. They all start with <code>fct_</code>.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/hex_forcats.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Hex sticker of the {forcats} package"><img src="images/hex_forcats.png" class="img-fluid figure-img" data-alt-text="The forcats hexagonal logo features four lazy black cats in a cardboard box." width="100" alt="Hex sticker of the {forcats} package"></a></p>
<figcaption>Hex sticker of the <a href="https://forcats.tidyverse.org/">{forcats}</a> package</figcaption>
</figure>
</div>
</div></div><div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your turn!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p><span style="color:green;"><strong>Q9.1</strong></span> Type <code>?fct_</code> in an <code>R</code> script or directly in the Console and then press the tab key (↹ or ⇥ on your keyboard). A list of all loaded functions that start with <code>fct_</code> should pop up. Which of these is <em>not</em> listed?</p>
<div class="cell">
<div class="cell-output-display">
<form name="form_70985" onsubmit="return validate_form_70985()" method="post">
<label>
<input type="radio" name="answer_70985" id="answer_70985_1" value="fct_count">
fct_count
</label>
<br>
<label>
<input type="radio" name="answer_70985" id="answer_70985_2" value="fct_mutate">
fct_mutate
</label>
<br>
<label>
<input type="radio" name="answer_70985" id="answer_70985_3" value="fct_na_level_to_value">
fct_na_level_to_value
</label>
<br>
<label>
<input type="radio" name="answer_70985" id="answer_70985_4" value="fct_rev">
fct_rev
</label>
<br>
<label>
<input type="radio" name="answer_70985" id="answer_70985_5" value="fct_reorder">
fct_reorder
</label>
<br>
<input type="submit" value="Check answer">
<div id="result_70985"></div>
</form>
<script>function validate_form_70985() {var x, text; var x = document.forms['form_70985']['answer_70985'].value;if (x == 'fct_mutate'){text = 'That’s right!';} else {text = 'No, if you call the help file of this function using <code>?</code> or <code>help()</code>, you will see that this function is part of the {forcats} package. You should have loaded it when you loaded the {tidyverse} collection of packages using <code>library(tidyverse)</code> at the beginning of the chapter.';} document.getElementById('result_70985').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1;res1 = document.getElementById('result_70985').innerText == 'That’s right!';text = res1;element.innerHTML = text;
         return false;
         }}</script>
</div>
</div>
<p>&nbsp;</p>
<p><span style="color:green;"><strong>Q9.2</strong></span> In the factor object <code>L1.Gender.fct</code> (which we created above), the first level is “F” because it comes first in the alphabet. Which of these commands will make “M” the first level instead? Check out the help files of the following <a href="https://forcats.tidyverse.org/">{forcats}</a> functions to understand what they do and try them out.</p>
<div class="cell">
<div class="cell-output-display">
<form name="form_25731" onsubmit="return validate_form_25731()" method="post">
<label>
<input type="checkbox" id="answer_25731_1" value="fct_match(L1.Gender.fct, c(&quot;M&quot;, &quot;F&quot;))">
fct_match(L1.Gender.fct, c("M", "F"))
</label>
<br>
<label>
<input type="checkbox" id="answer_25731_2" value="fct_recode(L1.Gender.fct, first = &quot;M&quot;, second = &quot;F&quot;)">
fct_recode(L1.Gender.fct, first = "M", second = "F")
</label>
<br>
<label>
<input type="checkbox" id="answer_25731_3" value="fct_reorder(L1.Gender.fct, c(&quot;M&quot;, &quot;F&quot;))">
fct_reorder(L1.Gender.fct, c("M", "F"))
</label>
<br>
<label>
<input type="checkbox" id="answer_25731_4" value="fct_rev(L1.Gender.fct)">
fct_rev(L1.Gender.fct)
</label>
<br>
<label>
<input type="checkbox" id="answer_25731_5" value="fct_relevel(L1.Gender.fct, &quot;M&quot;)">
fct_relevel(L1.Gender.fct, "M")
</label>
<br>
<input type="submit" value="Check answer">
<div id="result_25731"></div>
</form>
<script>function validate_form_25731() {var text; var x1 = document.getElementById('answer_25731_1'); var x2 = document.getElementById('answer_25731_2'); var x3 = document.getElementById('answer_25731_3'); var x4 = document.getElementById('answer_25731_4'); var x5 = document.getElementById('answer_25731_5'); if (x1.checked == false&x2.checked == true&x3.checked == false&x4.checked == true&x5.checked == true){text = 'Correct, well done!';} else {text = 'No, not quite. Note that three of these commands will yield the desired outcome! Check out the functions’ descriptions in the help files, as some of these function names may be misleading.';} document.getElementById('result_25731').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1, res2;res1 = document.getElementById('result_70985').innerText == 'That’s right!'; res2 = document.getElementById('result_25731').innerText == 'Correct, well done!';text = res1 + res2;element.innerHTML = text;
         return false;
         }}</script>
</div>
<div class="cell-output-display">
<div id="hint_96806" onmouseover="return show_hint_96806()">😇 Hover for a hint</div>
<div id="result_96806" onmouseover="return show_hint_96806()"></div>
<script>function show_hint_96806(){var x = document.getElementById('result_96806').innerHTML; if(!x){document.getElementById('result_96806').innerHTML = 'Use the <code>?</code> function to access the help files of each function and then try the above commands out! When you print an entire factor variable in the Console, the order of the levels is displayed at the bottom of the output. If the last line of your output reads “Levels: M F”, then the operation was successful.';} else {document.getElementById('result_96806').innerHTML = '';}}</script>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="sec-Preprocessing" class="level2 page-columns page-full" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="sec-Preprocessing"><span class="header-section-number">9.4</span> Pre-processing data</h2>
<section id="sec-mutate" class="level3 page-columns page-full" data-number="9.4.1">
<h3 data-number="9.4.1" class="anchored" data-anchor-id="sec-mutate"><span class="header-section-number">9.4.1</span> Using <code>mutate()</code> to add and replace columns</h3>
<p>In the previous section, we stored the factor representing L1 participants’ gender as a separate <code>R</code> object called <code>L1.Gender.fct</code>. If, instead, we want to add this factor as an additional column to our dataset, we can use the <code>mutate()</code> function from <a href="https://dplyr.tidyverse.org/">{dplyr}</a>.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/hex_dplyr.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Hex sticker of the {dplyr} package"><img src="images/hex_dplyr.png" class="img-fluid figure-img" width="100" alt="Hex sticker of the {dplyr} package"></a></p>
<figcaption>Hex sticker of the <a href="https://dplyr.tidyverse.org/">{dplyr}</a> package</figcaption>
</figure>
</div>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>L1.data <span class="ot">&lt;-</span> L1.data <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gender.fct =</span> <span class="fu">factor</span>(L1.data<span class="sc">$</span>Gender))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>mutate()</code> function allows us to add new columns to a dataset. By default, it also keeps all the existing ones (to control which columns are retained, check the help file and read about the “.keep =” argument).</p>
<div id="fig-mutate" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Cartoon of cute fuzzy monsters dressed up as different X-men characters, working together to add a new column to an existing data frame. Stylized title text reads “dplyr::mutate - add columns, keep existing.”">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mutate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/AHorst_mutate.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure&nbsp;9.4: Artwork explaining the dplyr::mutate() function by @allison_horst."><img src="images/AHorst_mutate.png" class="img-fluid figure-img" alt="Cartoon of cute fuzzy monsters dressed up as different X-men characters, working together to add a new column to an existing data frame. Stylized title text reads “dplyr::mutate - add columns, keep existing.”" width="465"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mutate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.4: Artwork explaining the <code>dplyr::mutate()</code> function by <a href="https://allisonhorst.com/allison-horst">@allison_horst</a>.
</figcaption>
</figure>
</div>
<p>We can use the <code>colnames()</code> function to check that the new column has been correctly appended to the table. Alternatively, you can use the <code>View()</code> function to display the table in full in a new <em>RStudio</em> tab. In both cases, you should see that the new column is now the last column in the table (column number 32).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(L1.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1] "Participant" "Age"         "Gender"      "Occupation"  "OccupGroup" 
 [6] "OtherLgs"    "Education"   "EduYrs"      "ReadEng1"    "ReadEng2"   
[11] "ReadEng3"    "ReadEng"     "Active"      "ObjCl"       "ObjRel"     
[16] "Passive"     "Postmod"     "Q.has"       "Q.is"        "Locative"   
[21] "SubCl"       "SubRel"      "GrammarR"    "Grammar"     "VocabR"     
[26] "Vocab"       "CollocR"     "Colloc"      "Blocks"      "ART"        
[31] "LgAnalysis"  "Gender.fct" </code></pre>
</div>
</div>
<p>Watch out: if you add a new column to a table using an existing column name, <code>mutate()</code> will overwrite the entire content of the existing column with the new values! In the following code chunk, we are therefore overwriting the character vector <code>Gender</code> with a factor vector also called <code>Gender</code>. We should only do this if we are certain that we won’t need to compare the original values with the new ones!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>L1.data <span class="ot">&lt;-</span> L1.data <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gender =</span> <span class="fu">factor</span>(L1.data<span class="sc">$</span>Gender))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-across" class="level3" data-number="9.4.2">
<h3 data-number="9.4.2" class="anchored" data-anchor-id="sec-across"><span class="header-section-number">9.4.2</span> Using <code>across()</code> to transform multiple columns</h3>
<p>In addition to <code>Gender</code>, there are quite a few more character vectors in <code>L1.data</code> that represent categorical variables and that would therefore be better stored as factors. We could use <code>mutate()</code> and <code>factor()</code> to convert them one by one like we did for <code>Gender</code> above, but that would require several lines of code in which we could easily make a silly error or two. Instead, we can use a series of neat tidyverse functions to convert all character vectors to factor vectors in one go.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>L1.data.fct <span class="ot">&lt;-</span> L1.data <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), factor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Above, we use <code>mutate()</code> to convert <code>across()</code> the entire dataset all columns <code>where()</code> there are character vectors to <code>factor()</code> vectors (using the <code>is.character()</code> function to determine which columns contain character vectors).</p>
<div id="fig-across" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A cute round fuzzy monster with fairy wings and a wand, with a party hat on reading “mean”, bouncing across the top of a data table applying the function to each column. Stylized text reads: “dplyr::across() - use within mutate() or summarize() to apply function(s) to a selection of columns!” An example shows the use within summarize: summarize(across(where(is.numeric), mean)).">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-across-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/AHorst_across.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Figure&nbsp;9.5: Artwork explaining the across() function by @allison_horst."><img src="images/AHorst_across.png" class="img-fluid figure-img" alt="A cute round fuzzy monster with fairy wings and a wand, with a party hat on reading “mean”, bouncing across the top of a data table applying the function to each column. Stylized text reads: “dplyr::across() - use within mutate() or summarize() to apply function(s) to a selection of columns!” An example shows the use within summarize: summarize(across(where(is.numeric), mean))."></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-across-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.5: Artwork explaining the <code>across()</code> function by <a href="https://allisonhorst.com/allison-horst">@allison_horst</a>.
</figcaption>
</figure>
</div>
<p>We can check that the correct variables have been converted by comparing the output of <code>summary(L1.data)</code> (partially printed in <a href="#sec-CheckNumeric" class="quarto-xref"><span>Section 9.3.1</span></a>) with the output of <code>summary(L1.data.fct)</code> (partially printed below).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(L1.data.fct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  Participant      Age        Gender          Occupation OccupGroup
 1      : 1   Min.   :17.00   F:48   Retired       :14   C  :22    
 100    : 1   1st Qu.:25.00   M:42   Student       :14   I  :23    
 101    : 1   Median :32.00          Unemployed    : 4   M  :20    
 104    : 1   Mean   :37.54          Housewife     : 3   PS :24    
 106    : 1   3rd Qu.:55.00          Shop Assistant: 3   PS : 1    
 107    : 1   Max.   :65.00          Teacher       : 3             
 (Other):84                          (Other)       :49             
    OtherLgs                                  Education      EduYrs     
 French : 2   student                              : 8   Min.   :10.00  
 German : 3   A level                              : 5   1st Qu.:12.00  
 None   :84   BA                                   : 5   Median :13.00  
 Spanish: 1   GCSEs                                : 5   Mean   :13.71  
              NVQ                                  : 4   3rd Qu.:14.00  
              Northern Counties School Leaving Exam: 3   Max.   :21.00  
              (Other)                              :60                  
    ReadEng1        ReadEng2        ReadEng3        ReadEng      
 Min.   :0.000   Min.   :0.000   Min.   :0.000   Min.   : 0.000  
 1st Qu.:1.000   1st Qu.:1.000   1st Qu.:2.000   1st Qu.: 5.000  
 Median :2.000   Median :2.000   Median :2.000   Median : 7.000  
 Mean   :2.522   Mean   :2.433   Mean   :2.233   Mean   : 7.189  
 3rd Qu.:3.000   3rd Qu.:3.000   3rd Qu.:3.000   3rd Qu.: 9.750  
 Max.   :5.000   Max.   :5.000   Max.   :4.000   Max.   :14.000  
                                                                 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your turn!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>In this <span style="color:green;"><strong>task</strong></span>, you will do some data wrangling on the L2 dataset from <span class="citation" data-cites="DabrowskaExperienceAptitudeIndividual2019">Dąbrowska (<a href="99_references.html#ref-DabrowskaExperienceAptitudeIndividual2019" role="doc-biblioref">2019</a>)</span>.</p>
<p><span style="color:green;"><strong>Q9.3</strong></span> Which of these columns from <code>L2.data</code> represent categorical variables and therefore ought to be converted to factors?</p>
<div class="cell">
<div class="cell-output-display">
<form name="form_18811" onsubmit="return validate_form_18811()" method="post">
<label>
<input type="checkbox" id="answer_18811_1" value="UseEngC">
UseEngC
</label>
<br>
<label>
<input type="checkbox" id="answer_18811_2" value="NativeLg">
NativeLg
</label>
<br>
<label>
<input type="checkbox" id="answer_18811_3" value="OccupGroup">
OccupGroup
</label>
<br>
<label>
<input type="checkbox" id="answer_18811_4" value="Arrival">
Arrival
</label>
<br>
<label>
<input type="checkbox" id="answer_18811_5" value="EdNative">
EdNative
</label>
<br>
<label>
<input type="checkbox" id="answer_18811_6" value="FirstExp">
FirstExp
</label>
<br>
<input type="submit" value="Check answer">
<div id="result_18811"></div>
</form>
<script>function validate_form_18811() {var text; var x1 = document.getElementById('answer_18811_1'); var x2 = document.getElementById('answer_18811_2'); var x3 = document.getElementById('answer_18811_3'); var x4 = document.getElementById('answer_18811_4'); var x5 = document.getElementById('answer_18811_5'); var x6 = document.getElementById('answer_18811_6'); if (x1.checked == false&x2.checked == true&x3.checked == true&x4.checked == false&x5.checked == true&x6.checked == false){text = 'That’s right!';} else {text = 'Not quite. Three of the above are categorical variables.';} document.getElementById('result_18811').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1, res2, res3;res1 = document.getElementById('result_70985').innerText == 'That’s right!'; res2 = document.getElementById('result_25731').innerText == 'Correct, well done!'; res3 = document.getElementById('result_18811').innerText == 'That’s right!';text = res1 + res2 + res3;element.innerHTML = text;
         return false;
         }}</script>
</div>
<div class="cell-output-display">
<div id="hint_35547" onclick="return show_hint_35547()">🐭 Click on the mouse for a hint.</div>
<div id="result_35547" onclick="return show_hint_35547()"></div>
<script>function show_hint_35547(){var x = document.getElementById('result_35547').innerHTML; if(!x){document.getElementById('result_35547').innerHTML = 'Run the <code>str(L2.data)</code> command to examine the structure of the L2 dataset.';} else {document.getElementById('result_35547').innerHTML = '';}}</script>
</div>
</div>
<p><span style="color:green;"><strong>Q9.4</strong></span> Convert all character vectors of <code>L2.data</code> to factors and save the new table as <code>L2.data.fct</code>. Use the <code>str()</code> function to check that your conversion has worked as planned. How many different factor levels are there in the categorical variable <code>Occupation</code>?</p>
<div class="cell">
<div class="cell-output-display">
<form name="form_66635" onsubmit="return validate_form_66635()" method="post">
<label>
<input type="radio" name="answer_66635" id="answer_66635_1" value="67">
67
</label>
<br>
<label>
<input type="radio" name="answer_66635" id="answer_66635_2" value="45">
45
</label>
<br>
<label>
<input type="radio" name="answer_66635" id="answer_66635_3" value="27">
27
</label>
<br>
<label>
<input type="radio" name="answer_66635" id="answer_66635_4" value="48">
48
</label>
<br>
<label>
<input type="radio" name="answer_66635" id="answer_66635_5" value="44">
44
</label>
<br>
<label>
<input type="radio" name="answer_66635" id="answer_66635_6" value="4">
4
</label>
<br>
<input type="submit" value="Check answer">
<div id="result_66635"></div>
</form>
<script>function validate_form_66635() {var x, text; var x = document.forms['form_66635']['answer_66635'].value;if (x == '48'){text = 'That’s right.';} else {text = 'No';} document.getElementById('result_66635').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1, res2, res3, res4;res1 = document.getElementById('result_70985').innerText == 'That’s right!'; res2 = document.getElementById('result_25731').innerText == 'Correct, well done!'; res3 = document.getElementById('result_18811').innerText == 'That’s right!'; res4 = document.getElementById('result_66635').innerText == 'That’s right.';text = res1 + res2 + res3 + res4;element.innerHTML = text;
         return false;
         }}</script>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>🐭 Click on the mouse to view <code>R</code> code to help you answer <strong>c.</strong></summary>
<div class="sourceCode cell-code" id="cb21" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>L2.data.fct <span class="ot">&lt;-</span> L2.data <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), factor))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(L2.data.fct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span style="color:green;"><strong>Q9.5</strong></span> Use the <code>summary()</code> and <code>str()</code> functions to inspect the sanity of L2 dataset now that you have converted all the character vectors to factors. Have you noticed that there three factor levels in the <code>Gender</code> variable of the L2 dataset whereas there are only two in the L1 dataset? What is the most likely reason for this?</p>
<div class="cell">
<div class="cell-output-display">
<form name="form_4220" onsubmit="return validate_form_4220()" method="post">
<label>
<input type="radio" name="answer_4220" id="answer_4220_1" value="Because sometimes &quot;female&quot; was recorded as lower-case &quot;f&quot; rather than upper-case &quot;F&quot;.">
Because sometimes "female" was recorded as lower-case "f" rather than upper-case "F".
</label>
<br>
<label>
<input type="radio" name="answer_4220" id="answer_4220_2" value="Because these six participants were under 18 at the time of data collection.">
Because these six participants were under 18 at the time of data collection.
</label>
<br>
<label>
<input type="radio" name="answer_4220" id="answer_4220_3" value="Because these six participants declined to answer the question about their gender.">
Because these six participants declined to answer the question about their gender.
</label>
<br>
<label>
<input type="radio" name="answer_4220" id="answer_4220_4" value="Because these six participants identify as non-binary.">
Because these six participants identify as non-binary.
</label>
<br>
<input type="submit" value="Check answer">
<div id="result_4220"></div>
</form>
<script>function validate_form_4220() {var x, text; var x = document.forms['form_4220']['answer_4220'].value;if (x == 'Because sometimes "female" was recorded as lower-case "f" rather than upper-case "F".'){text = 'Your intuition is correct (and this is confirmed by the author in the description of the L2 participants in the published paper).';} else {text = 'No, it turns out that this is not the reason.';} document.getElementById('result_4220').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1, res2, res3, res4, res5;res1 = document.getElementById('result_70985').innerText == 'That’s right!'; res2 = document.getElementById('result_25731').innerText == 'Correct, well done!'; res3 = document.getElementById('result_18811').innerText == 'That’s right!'; res4 = document.getElementById('result_66635').innerText == 'That’s right.'; res5 = document.getElementById('result_4220').innerText == 'Your intuition is correct (and this is confirmed by the author in the description of the L2 participants in the published paper).';text = res1 + res2 + res3 + res4 + res5;element.innerHTML = text;
         return false;
         }}</script>
</div>
<div class="cell-output-display">
<div id="hint_1549" onclick="return show_hint_1549()">🐭 Click on the mouse for a hint.</div>
<div id="result_1549" onclick="return show_hint_1549()"></div>
<script>function show_hint_1549(){var x = document.getElementById('result_1549').innerHTML; if(!x){document.getElementById('result_1549').innerHTML = 'Once you have converted all the character vectors to factors in both <code>L1.data</code> and <code>L2.data</code>, compare the outputs of <code>summary(L1.data$Gender)</code> and <code>summary(L2.data$Gender)</code>.';} else {document.getElementById('result_1549').innerHTML = '';}}</script>
</div>
</div>
<p>&nbsp;</p>
</div>
</div>
</div>
</section>
</section>
<section id="data-cleaning" class="level2 page-columns page-full" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="data-cleaning"><span class="header-section-number">9.5</span> Data cleaning 🧼</h2>
<p>By closely examining the data, we noticed that the values of the categorical variables were not always entered in a consistent way, which may lead to incorrect analyses. For example, in the L2 dataset, most female participants’ gender is recorded as <code>F</code> except for six participants, where it is <code>f</code>. As <code>R</code> is a case-sensitive language, these two factor levels are treated as two different levels of the <code>Gender</code> variable. This means that any future analyses on the effect of <code>Gender</code> on language learning will compare participants across these three groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(L2.data.fct<span class="sc">$</span>Gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> f  F  M 
 6 40 21 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>To ensure that our analyses are <strong>reproducible</strong> (see <a href="14_LiterateProgramming.html#sec-Reproducibility" class="quarto-xref"><span>Section 14.2</span></a>) from the beginning to the end, it is crucial that we document <em>all</em> of our corrections in a script. This ensures that if we need to go back on any data pre-processing decision that we made or if we need to make any additional corrections, we can do so without having to re-do our entire analyses. In addition, it means that our corrections and other data pre-processing steps are transparent and can be inspected and challenged by our peers.</p>
</div>
</div>
<section id="sec-stringR" class="level3 page-columns page-full" data-number="9.5.1">
<h3 data-number="9.5.1" class="anchored"><span class="header-section-number">9.5.1</span> Using {stringr} functions</h3>
<p>To convert all of the lower-case “f” in the <code>Gender</code> variable to upper-case “F”, we can combine the <code>mutate()</code> with the <code>str_to_upper()</code> function. This ensures that all values in the new <code>Gender.corrected</code> column are in capital letters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>L2.data.cleaned <span class="ot">&lt;-</span> L2.data.fct <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gender.corrected =</span> <span class="fu">str_to_upper</span>(Gender))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We should check that our correction has gone to plan by comparing the original <code>Gender</code> variable with the new <code>Gender.corrected</code>. To this end, we display them side by side using the <code>select()</code> function from {dplyr}.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>L2.data.cleaned <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Gender, Gender.corrected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  Gender Gender.corrected
1      F                F
2      f                F
3      F                F
4      F                F
5      M                M
6      F                F</code></pre>
</div>
</div>
<p>Like <code>mutate()</code> and <code>select()</code>, <code>str_to_upper()</code> also comes from a tidyverse package<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. All functions that begin with <code>str_</code> come from the {stringr} package, which features lots of useful functions to manipulate character string vectors. These include:</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/hex_stringr.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Hex sticker of the {stringr} package"><img src="images/hex_stringr.png" class="img-fluid figure-img" width="100" alt="Hex sticker of the {stringr} package"></a></p>
<figcaption>Hex sticker of the <a href="https://stringr.tidyverse.org/">{stringr}</a> package</figcaption>
</figure>
</div>
</div></div><ul>
<li><code>str_to_upper()</code> converts to string upper case.</li>
<li><code>str_to_lower()</code> converts to string lower case.</li>
<li><code>str_to_title()</code> converts to string title case (i.e.&nbsp;only the first letter of each word is capitalised).</li>
<li><code>str_to_sentence()</code> converts string to sentence case (i.e.&nbsp;only the first letter of each sentence is capitalised).</li>
</ul>
<p>For more useful functions to manipulate character strings, check out the {stringr} cheatsheet: <a href="https://github.com/rstudio/cheatsheets/blob/main/strings.pdf" class="uri">https://github.com/rstudio/cheatsheets/blob/main/strings.pdf</a>.</p>
<p>Note that in the code chunk above, we did not save the output to a new <code>R</code> object. We merely printed the output in the Console. Once we have checked that our data wrangling operation went well, we can overwrite the original <code>Gender</code> variable with the cleaned version by using the original variable name as the name of the new column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>L2.data.cleaned <span class="ot">&lt;-</span> L2.data.fct <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gender =</span> <span class="fu">str_to_upper</span>(Gender))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using <code>summary()</code> or <code>class()</code>, we can see that manipulating the <code>Gender</code> variable with a function from {stringr} has resulted in the factor variable being converted back to a character variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(L2.data.cleaned<span class="sc">$</span>Gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>   Length     Class      Mode 
       67 character character </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(L2.data.cleaned<span class="sc">$</span>Gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] "character"</code></pre>
</div>
</div>
<p>We therefore need to add a line of code to reconvert it to a factor. We can do this within a single <code>mutate()</code> command.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>L2.data.cleaned <span class="ot">&lt;-</span> L2.data.fct <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gender =</span> <span class="fu">str_to_upper</span>(Gender),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">Gender =</span> <span class="fu">factor</span>(Gender))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(L2.data.cleaned<span class="sc">$</span>Gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] "factor"</code></pre>
</div>
</div>
<p>Now the <code>summary()</code> function provides a tally of male and female participants that corresponds to the values reported in <span class="citation" data-cites="DabrowskaExperienceAptitudeIndividual2019">Dąbrowska (<a href="99_references.html#ref-DabrowskaExperienceAptitudeIndividual2019" role="doc-biblioref">2019: 5</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(L2.data.cleaned<span class="sc">$</span>Gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> F  M 
46 21 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your turn!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>This <span style="color:green;"><strong>task</strong></span> focuses on the <code>OccupGroup</code> variable, which is found in both the L1 and L2 datasets.</p>
<p><code>OccupGroup</code> is a categorical variable that groups participants’ professional occupations into different categories. In the L2 dataset, there are four occupational categories.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>L2.data.fct <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(OccupGroup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  OccupGroup  n
1          C 10
2          I  3
3          M 21
4         PS 33</code></pre>
</div>
</div>
<p><span class="citation" data-cites="DabrowskaExperienceAptitudeIndividual2019">Dąbrowska (<a href="99_references.html#ref-DabrowskaExperienceAptitudeIndividual2019" role="doc-biblioref">2019: 6</a>)</span> explains that these abbreviations correspond to:</p>
<blockquote class="blockquote">
<p><strong>C</strong>: Clerical positions<br>
<strong>I</strong>: Occupationally inactive (i.e., unemployed, retired, or homemakers)<br>
<strong>M</strong>: Manual jobs<br>
<strong>PS</strong>: Professional-level jobs or studying for a degree</p>
</blockquote>
<p><span style="color:green;"><strong>Q9.6</strong></span> Examine the <code>OccupGroup</code> variable in the L1 dataset (<code>L1.data</code>). What do you notice? Why are L1 participants grouped into five rather than four occupational categories?</p>
<div class="cell">
<div class="cell-output-display">
<form name="form_25248" onsubmit="return validate_form_25248()" method="post">
<label>
<input type="radio" name="answer_25248" id="answer_25248_1" value="Because this study has more L1 participants than L2 participants.">
Because this study has more L1 participants than L2 participants.
</label>
<br>
<label>
<input type="radio" name="answer_25248" id="answer_25248_2" value="Because one L1 participant had an occupation that did not fit any of the other four categories.">
Because one L1 participant had an occupation that did not fit any of the other four categories.
</label>
<br>
<label>
<input type="radio" name="answer_25248" id="answer_25248_3" value="Because an extra space character was accidentally added after one &quot;PS&quot; value.">
Because an extra space character was accidentally added after one "PS" value.
</label>
<br>
<label>
<input type="radio" name="answer_25248" id="answer_25248_4" value="Because the original data file was saved in a format incompatible with R.">
Because the original data file was saved in a format incompatible with R.
</label>
<br>
<input type="submit" value="Check answer">
<div id="result_25248"></div>
</form>
<script>function validate_form_25248() {var x, text; var x = document.forms['form_25248']['answer_25248'].value;if (x == 'Because an extra space character was accidentally added after one "PS" value.'){text = 'That’s right, well done! This <strong>trailing space</strong> needs to be removed otherwise <code>R</code> (and most other data analysis programmes) will consider this value to represent a fifth occupational category.';} else {text = 'No, that’s not the reason. Have you noticed that, in the output of the <code>summary(L1.data.fct$OccupGroup)</code> command, the last category does not appear to be right-aligned like the others? Why might that be?';} document.getElementById('result_25248').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1, res2, res3, res4, res5, res6;res1 = document.getElementById('result_70985').innerText == 'That’s right!'; res2 = document.getElementById('result_25731').innerText == 'Correct, well done!'; res3 = document.getElementById('result_18811').innerText == 'That’s right!'; res4 = document.getElementById('result_66635').innerText == 'That’s right.'; res5 = document.getElementById('result_4220').innerText == 'Your intuition is correct (and this is confirmed by the author in the description of the L2 participants in the published paper).'; res6 = document.getElementById('result_25248').innerText == 'That’s right, well done! This trailing space needs to be removed otherwise R (and most other data analysis programmes) will consider this value to represent a fifth occupational category.';text = res1 + res2 + res3 + res4 + res5 + res6;element.innerHTML = text;
         return false;
         }}</script>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>🐭 Click on the mouse to help you answer <strong>a.</strong></summary>
<div class="sourceCode cell-code" id="cb38" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(L1.data.fct<span class="sc">$</span>OccupGroup)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="do">##   C   I   M  PS PS  </span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  22  23  20  24   1</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>L1.data.fct <span class="sc">|&gt;</span> </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(OccupGroup)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   OccupGroup  n</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1          C 22</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 2          I 23</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 3          M 20</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 4         PS 24</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 5        PS   1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
<p><span style="color:green;"><strong>Q9.7</strong></span> Which {stringr} function removes trailing spaces from character strings? Find the appropriate function on the <a href="https://github.com/rstudio/cheatsheets/blob/main/strings.pdf">{stringr} cheatsheet</a>.</p>
<div class="cell">
<div class="cell-output-display">
<form name="form_11643" onsubmit="return validate_form_11643()" method="post">
<label>
<input type="radio" name="answer_11643" id="answer_11643_1" value="str_squish()">
str_squish()
</label>
<br>
<label>
<input type="radio" name="answer_11643" id="answer_11643_2" value="str_trim()">
str_trim()
</label>
<br>
<label>
<input type="radio" name="answer_11643" id="answer_11643_3" value="str_ends()">
str_ends()
</label>
<br>
<label>
<input type="radio" name="answer_11643" id="answer_11643_4" value="str_flatten()">
str_flatten()
</label>
<br>
<label>
<input type="radio" name="answer_11643" id="answer_11643_5" value="str_extract()">
str_extract()
</label>
<br>
<label>
<input type="radio" name="answer_11643" id="answer_11643_6" value="str_glue()">
str_glue()
</label>
<br>
<input type="submit" value="Check answer">
<div id="result_11643"></div>
</form>
<script>function validate_form_11643() {var x, text; var x = document.forms['form_11643']['answer_11643'].value;if (x == 'str_trim()'){text = 'That’s right! Now, use <code>str_trim()</code> to remove all trailing spaces in the <code>OccupGroup</code> variable. Check that you then have an L1 dataset with only four occupational categories.';} else {text = 'No, this function won’t help us for this task. You can use the <code>?</code> command to find out more about each of these functions if you’re struggling to interpret the <a href="https://github.com/rstudio/cheatsheets/blob/main/strings.pdf">{stringr} cheatsheet</a>.';} document.getElementById('result_11643').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1, res2, res3, res4, res5, res6, res7;res1 = document.getElementById('result_70985').innerText == 'That’s right!'; res2 = document.getElementById('result_25731').innerText == 'Correct, well done!'; res3 = document.getElementById('result_18811').innerText == 'That’s right!'; res4 = document.getElementById('result_66635').innerText == 'That’s right.'; res5 = document.getElementById('result_4220').innerText == 'Your intuition is correct (and this is confirmed by the author in the description of the L2 participants in the published paper).'; res6 = document.getElementById('result_25248').innerText == 'That’s right, well done! This trailing space needs to be removed otherwise R (and most other data analysis programmes) will consider this value to represent a fifth occupational category.'; res7 = document.getElementById('result_11643').innerText == 'That’s right! Now, use str_trim() to remove all trailing spaces in the OccupGroup variable. Check that you then have an L1 dataset with only four occupational categories.';text = res1 + res2 + res3 + res4 + res5 + res6 + res7;element.innerHTML = text;
         return false;
         }}</script>
</div>
<div class="cell-output-display">
<div id="hint_1531" onclick="return show_hint_1531()">🐭 Click on the mouse for a hint.</div>
<div id="result_1531" onclick="return show_hint_1531()"></div>
<script>function show_hint_1531(){var x = document.getElementById('result_1531').innerHTML; if(!x){document.getElementById('result_1531').innerHTML = 'The function can be found in the “Manage Lengths” section of the <a href="https://github.com/rstudio/cheatsheets/blob/main/strings.pdf">{stringr} cheatsheet</a>.';} else {document.getElementById('result_1531').innerHTML = '';}}</script>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show <code>R</code> code to use the function and check that it worked as expected.</summary>
<div class="sourceCode cell-code" id="cb39" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>L1.data.cleaned <span class="ot">&lt;-</span> L1.data.fct <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OccupGroup =</span> <span class="fu">str_trim</span>(OccupGroup))</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>L1.data.cleaned <span class="sc">|&gt;</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(OccupGroup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
<p><span style="color:green;"><strong>Q9.8</strong></span> Following the removal of trailing whitespaces, what percentage of L1 participants have a professional-level jobs/are studying for a degree?</p>
<div class="cell">
<div class="cell-output-display">
<form name="form_51193" onsubmit="return validate_form_51193()" method="post">
<label>
<input type="radio" name="answer_51193" id="answer_51193_1" value="20%">
20%
</label>
<br>
<label>
<input type="radio" name="answer_51193" id="answer_51193_2" value="22.22%">
22.22%
</label>
<br>
<label>
<input type="radio" name="answer_51193" id="answer_51193_3" value="24.44%">
24.44%
</label>
<br>
<label>
<input type="radio" name="answer_51193" id="answer_51193_4" value="25%">
25%
</label>
<br>
<label>
<input type="radio" name="answer_51193" id="answer_51193_5" value="26%">
26%
</label>
<br>
<label>
<input type="radio" name="answer_51193" id="answer_51193_6" value="28%">
28%
</label>
<br>
<input type="submit" value="Check answer">
<div id="result_51193"></div>
</form>
<script>function validate_form_51193() {var x, text; var x = document.forms['form_51193']['answer_51193'].value;if (x == '28%'){text = 'That’s right, well done!';} else {text = 'No, check the hint or look at the <code>R</code> code below if you’re stuck.';} document.getElementById('result_51193').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1, res2, res3, res4, res5, res6, res7, res8;res1 = document.getElementById('result_70985').innerText == 'That’s right!'; res2 = document.getElementById('result_25731').innerText == 'Correct, well done!'; res3 = document.getElementById('result_18811').innerText == 'That’s right!'; res4 = document.getElementById('result_66635').innerText == 'That’s right.'; res5 = document.getElementById('result_4220').innerText == 'Your intuition is correct (and this is confirmed by the author in the description of the L2 participants in the published paper).'; res6 = document.getElementById('result_25248').innerText == 'That’s right, well done! This trailing space needs to be removed otherwise R (and most other data analysis programmes) will consider this value to represent a fifth occupational category.'; res7 = document.getElementById('result_11643').innerText == 'That’s right! Now, use str_trim() to remove all trailing spaces in the OccupGroup variable. Check that you then have an L1 dataset with only four occupational categories.'; res8 = document.getElementById('result_51193').innerText == 'That’s right, well done!';text = res1 + res2 + res3 + res4 + res5 + res6 + res7 + res8;element.innerHTML = text;
         return false;
         }}</script>
</div>
<div class="cell-output-display">
<div id="hint_2536" onclick="return show_hint_2536()">🐭 Click on the mouse for a hint.</div>
<div id="result_2536" onclick="return show_hint_2536()"></div>
<script>function show_hint_2536(){var x = document.getElementById('result_2536').innerHTML; if(!x){document.getElementById('result_2536').innerHTML = 'We are looking for the proportion of L1 participants assigned the occupational group “PS”. You will need to use the <code>count()</code> and the <code>mutate()</code> functions to be able to answer this question.';} else {document.getElementById('result_2536').innerHTML = '';}}</script>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show <code>R</code> code to answer question <strong>c.</strong></summary>
<div class="sourceCode cell-code" id="cb40" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>L1.data.cleaned <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(OccupGroup) <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">percent =</span> percent<span class="sc">*</span><span class="dv">100</span>, </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">percent =</span> <span class="fu">round</span>(percent, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<p>So far, we have looked at rather simple data cleaning cases. Let’s now turn to a slightly more complex one: In the L2 dataset, the variable <code>NativeLg</code> contains character string values that correspond to the L2 participants’ native language. Using the base <code>R</code> function <code>unique()</code>, we can see that there are a total of 22 unique values in this variable. However using <code>sort()</code> to order these 22 values alphabetically, we can easily see that there are, in fact, fewer unique native languages in this dataset due to different spellings and the inconsistent use of upper-case letters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>L2.data<span class="sc">$</span>NativeLg <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1] "Cantonese"           "Cantonese/Hokkein"   "chinese"            
 [4] "Chinese"             "french"              "German"             
 [7] "greek"               "Italian"             "Lithuanian"         
[10] "Lithunanina"         "Lituanian"           "Mandarin"           
[13] "Mandarin Chinese"    "Mandarin/ Cantonese" "mandarin/malaysian" 
[16] "Mandarine Chinese"   "polish"              "Polish"             
[19] "Polish/Russian"      "russian"             "Russian"            
[22] "Spanish"            </code></pre>
</div>
</div>
<p>If we convert all <code>NativeLg</code> values to title case, we can reduce the number of unique languages to 19.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>L2.data<span class="sc">$</span>NativeLg <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_to_title</span>() <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1] "Cantonese"           "Cantonese/Hokkein"   "Chinese"            
 [4] "French"              "German"              "Greek"              
 [7] "Italian"             "Lithuanian"          "Lithunanina"        
[10] "Lituanian"           "Mandarin"            "Mandarin Chinese"   
[13] "Mandarin/ Cantonese" "Mandarin/Malaysian"  "Mandarine Chinese"  
[16] "Polish"              "Polish/Russian"      "Russian"            
[19] "Spanish"            </code></pre>
</div>
</div>
<p>Second, to facilitate further analyses, we may decide to only retain the first word/language from each entry as this will further reduce the number of different levels in this categorical variable. To abbreviate “Mandarin Chinese” to “Mandarin”, we can use the <code>word()</code> function from the {stringr} package.</p>
<p>Below is an extract of the help page for the <code>word()</code> function (accessed with the command <code>?word</code>). Can you work out how to extract the first word of a character string?</p>
<blockquote class="blockquote">
<table class="caption-top table">
<tbody>
<tr class="odd">
<td>word {stringr}</td>
<td style="text-align: right;">R Documentation</td>
</tr>
</tbody>
</table>
<h2 id="sec-WordHelp" data-number="9.6" class="anchored" data-anchor-id="sec-stringR"><span class="header-section-number">9.6</span> Extract words from a sentence</h2>
<h3 id="description" data-number="9.6.1" class="anchored"><span class="header-section-number">9.6.1</span> Description</h3>
<p>Extract words from a sentence</p>
<h3 id="usage" data-number="9.6.2" class="anchored"><span class="header-section-number">9.6.2</span> Usage</h3>
<pre data-code-line-numbers=""><code>word(string, start = 1L, end = start, sep = fixed(" "))</code></pre>
<h3 id="arguments" data-number="9.6.3" class="anchored"><span class="header-section-number">9.6.3</span> Arguments</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 87%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>string</code></td>
<td>Input vector. Either a character vector, or something coercible to one.</td>
</tr>
<tr class="even">
<td><code>start</code>, <code>end</code></td>
<td><p>Pair of integer vectors giving range of words (inclusive) to extract. If negative, counts backwards from the last word.</p>
<p>The default value select the first word.</p></td>
</tr>
<tr class="odd">
<td><code>sep</code></td>
<td>Separator between words. Defaults to single space.</td>
</tr>
</tbody>
</table>
</blockquote>
<p>The help file tells us that “The default value select the first word”. In our case, this means that we can simply use the <code>word()</code> function with no specified argument as this will automatically retain only the first word of every entry.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>L2.data<span class="sc">$</span>NativeLg <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_to_title</span>() <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">word</span>() <span class="sc">|&gt;</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1] "Cantonese"          "Cantonese/Hokkein"  "Chinese"           
 [4] "French"             "German"             "Greek"             
 [7] "Italian"            "Lithuanian"         "Lithunanina"       
[10] "Lituanian"          "Mandarin"           "Mandarin/"         
[13] "Mandarin/Malaysian" "Mandarine"          "Polish"            
[16] "Polish/Russian"     "Russian"            "Spanish"           </code></pre>
</div>
</div>
<p>Alternatively, we can choose to specify the “start” argument as a reminder of what we did and to better document our code. The output is exactly the same.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>L2.data<span class="sc">$</span>NativeLg <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_to_title</span>() <span class="sc">|&gt;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">word</span>(<span class="at">start =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span> </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1] "Cantonese"          "Cantonese/Hokkein"  "Chinese"           
 [4] "French"             "German"             "Greek"             
 [7] "Italian"            "Lithuanian"         "Lithunanina"       
[10] "Lituanian"          "Mandarin"           "Mandarin/"         
[13] "Mandarin/Malaysian" "Mandarine"          "Polish"            
[16] "Polish/Russian"     "Russian"            "Spanish"           </code></pre>
</div>
</div>
<p>As you can tell from the output above, the <code>word()</code> function uses white space to identify word boundaries. In this dataset, however, some of the participants’ native languages are separated by forward slashes (<code>/</code>) rather than or in addition to spaces. The “Usage” section of the help file for the <code>word()</code> function (see <code>?word</code> and <a href="#sec-WordHelp" class="quarto-xref"><span>Section 9.6</span></a>) also confirms that the default word separator symbol is a space and shows us the syntax for changing the default separator. Below we change it to a forward slash.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>L2.data<span class="sc">$</span>NativeLg <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_to_title</span>() <span class="sc">|&gt;</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">word</span>(<span class="at">start =</span> <span class="dv">1</span>, <span class="at">sep =</span> <span class="fu">fixed</span>(<span class="st">"/"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span> </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1] "Cantonese"         "Chinese"           "French"           
 [4] "German"            "Greek"             "Italian"          
 [7] "Lithuanian"        "Lithunanina"       "Lituanian"        
[10] "Mandarin"          "Mandarin Chinese"  "Mandarine Chinese"
[13] "Polish"            "Russian"           "Spanish"          </code></pre>
</div>
</div>
<p>Now we can combine these two word extraction methods using the pipe operator (<code>|&gt;</code>) so that “Cantonese/Hokkein” is abbreviated to “Cantonese” and “Mandarin/ Cantonese” to “Mandarin”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>L2.data<span class="sc">$</span>NativeLg <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_to_title</span>() <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">word</span>(<span class="at">start =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="co"># Extracts the first word before the first space</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">word</span>(<span class="at">start =</span> <span class="dv">1</span>, <span class="at">sep =</span> <span class="fu">fixed</span>(<span class="st">"/"</span>)) <span class="sc">|&gt;</span> <span class="co"># Extracts the first word before the first forward slash</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span> </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1] "Cantonese"   "Chinese"     "French"      "German"      "Greek"      
 [6] "Italian"     "Lithuanian"  "Lithunanina" "Lituanian"   "Mandarin"   
[11] "Mandarine"   "Polish"      "Russian"     "Spanish"    </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Going further: Using regular expressions (regex) 🤓
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Many functions of the {stringr} package involve <strong>regular expressions</strong> (short: <strong>regex</strong>). The second page of the <a href="https://github.com/rstudio/cheatsheets/blob/main/strings.pdf">{stringr} cheatsheet</a> provides a nice overview of how regular expressions can be used to manipulate character strings in <code>R</code>.</p>
<p>Using the <code>str_extract()</code> function together with the regex <code>\\w+</code>, it is possible to extract the first word of each <code>NativeLg</code> value with just one line of code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>L2.data<span class="sc">$</span>NativeLg <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_to_title</span>() <span class="sc">|&gt;</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_extract</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">w+"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span> </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1] "Cantonese"   "Chinese"     "French"      "German"      "Greek"      
 [6] "Italian"     "Lithuanian"  "Lithunanina" "Lituanian"   "Mandarin"   
[11] "Mandarine"   "Polish"      "Russian"     "Spanish"    </code></pre>
</div>
</div>
<p>Regular expressions provide incredibly powerful and versatile ways to work with text in all kinds of programming languages. When conducting <strong>corpus linguistics</strong> research, they also allow us to conduct complex corpus queries.</p>
<p>Each programming language/software has a slightly different flavour of regex but the basic principles are the same across all languages/software and are well worth learning. To get started, I highly recommend this beautifully designed interactive regex tutorial for beginners: <a href="https://regexlearn.com/learn/regex101" class="uri">https://regexlearn.com/learn/regex101</a>. Have fun! 🤓</p>
</div>
</div>
</div>
</section>
<section id="sec-casewhen" class="level3" data-number="9.6.4">
<h3 data-number="9.6.4" class="anchored" data-anchor-id="sec-casewhen"><span class="header-section-number">9.6.4</span> Using <code>case_when()</code></h3>
<p>We have now reduced the number of levels in the <code>NativeLg</code> variable to just 14 unique languages. But we still have some typos to correct, e.g., “Lithunanina” and “Lituanian”.</p>
<p>We can correct these on a case-by-case basis using <code>case_when()</code>. This is a very useful tidyverse function from the {dplyr} package that is easy to use once you have gotten used to its syntax. <a href="#fig-case_when" class="quarto-xref">Figure&nbsp;<span>9.6</span></a> illustrates the syntax with a toy example dataset about the dangerousness of dragons (<code>df</code>). In this annotated line of code in <a href="#fig-case_when" class="quarto-xref">Figure&nbsp;<span>9.6</span></a>, <code>mutate()</code> is used to add a new column called <code>danger</code> whose values depend on the type of dragon that we are dealing with. The first argument of <code>case_when()</code> determines that, when the dragon <code>type</code> is equal to “kraken”, then the <code>danger</code> value is set to “extreme”, otherwise the danger value is set to “high”. You can see the outcome in the appended <code>danger</code> column.</p>
<div id="fig-case_when" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Cartoon showing a table with creature type (kraken, dragon, or cyclops) and age (baby, teen, or adult). The three creatures listed are adding a new column named “danger”, which contains the word “extreme!” if the type is “kraken”, or “high” for any other type. Stylized text reads “dplyr::case_when() - IF ELSE...but you love it? An example of code is shown: mutate(danger = case_when(type == “kraken” ~ “extreme!”, TRUE ~ “high”).">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-case_when-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/AHorst_case_when.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Figure&nbsp;9.6: Artwork explaining the case_when() function by @allison_horst)."><img src="images/AHorst_case_when.png" class="img-fluid figure-img" alt="Cartoon showing a table with creature type (kraken, dragon, or cyclops) and age (baby, teen, or adult). The three creatures listed are adding a new column named “danger”, which contains the word “extreme!” if the type is “kraken”, or “high” for any other type. Stylized text reads “dplyr::case_when() - IF ELSE...but you love it? An example of code is shown: mutate(danger = case_when(type == “kraken” ~ “extreme!”, TRUE ~ “high”)."></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-case_when-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.6: Artwork explaining the <code>case_when()</code> function by <a href="https://allisonhorst.com/allison-horst">@allison_horst</a>).
</figcaption>
</figure>
</div>
<p>Applying <code>case_when()</code> to fix the typos in the <code>NativeLg</code> variable in <code>L2.data</code>, we determine that:</p>
<ol type="a">
<li>if the shortened <code>NativeLg</code> value is “Mandarine”, we replace it with “Mandarin”, and</li>
<li>if the shortened <code>NativeLg</code> value corresponds to either “Lithunanina” or “Lituanian”, we replace it with “Lithuanian”.</li>
</ol>
<p>Using <code>mutate()</code>, we save this cleaned-up version of the <code>NativeLg</code> variable as a new column in our <code>L2.data</code> table, which we call <code>NativeLg.cleaned</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>L2.data <span class="ot">&lt;-</span> L2.data <span class="sc">|&gt;</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">NativeLg.cleaned =</span> <span class="fu">str_to_title</span>(NativeLg) <span class="sc">|&gt;</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">word</span>(<span class="at">start =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">word</span>(<span class="at">start =</span> <span class="dv">1</span>, <span class="at">sep =</span> <span class="fu">fixed</span>(<span class="st">"/"</span>)),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">NativeLg.cleaned =</span> <span class="fu">case_when</span>(</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>      NativeLg.cleaned <span class="sc">==</span> <span class="st">"Mandarine"</span> <span class="sc">~</span> <span class="st">"Mandarin"</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>      NativeLg.cleaned <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Lithunanina"</span>, <span class="st">"Lituanian"</span>) <span class="sc">~</span> <span class="st">"Lithuanian"</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> NativeLg.cleaned)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Whenever we do any data wrangling, it is crucial that we take the time to carefully check that we have not made any mistakes in the process. To this end, we display the original <code>NativeLg</code> and the new <code>NativeLg.cleaned</code> variables side by side using the <code>select()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>L2.data <span class="sc">|&gt;</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NativeLg, NativeLg.cleaned)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>    NativeLg NativeLg.cleaned
1 Lithuanian       Lithuanian
2     polish           Polish
3     Polish           Polish
4    Italian          Italian
5  Lituanian       Lithuanian
6     Polish           Polish</code></pre>
</div>
</div>
<p>As you can see, only the first six rows of the table are printed above. Run the code yourself to check all the other rows.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Using base <code>R</code> functions instead
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This chapter focuses on {tidyverse} functions, however all of the above data wrangling and cleaning operations can equally be achieved using base <code>R</code> functions. For example, the <code>mutate()</code> code chunk above could be replaced by the following lines of base <code>R</code> code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-80" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-80" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-80-1" class="code-annotation-target"><a href="#annotated-cell-80-1" aria-hidden="true" tabindex="-1"></a>L2.data<span class="sc">$</span>NativeLg.cleaned.base <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"([a-zA-Z]+).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, L2.data<span class="sc">$</span>NativeLg)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-80" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-80-2" class="code-annotation-target"><a href="#annotated-cell-80-2" aria-hidden="true" tabindex="-1"></a>L2.data<span class="sc">$</span>NativeLg.cleaned.base <span class="ot">&lt;-</span> tools<span class="sc">::</span><span class="fu">toTitleCase</span>(L2.data<span class="sc">$</span>NativeLg.cleaned.base)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-80" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-80-3" class="code-annotation-target"><a href="#annotated-cell-80-3" aria-hidden="true" tabindex="-1"></a>L2.data<span class="sc">$</span>NativeLg.cleaned.base[L2.data<span class="sc">$</span>NativeLg.cleaned.base <span class="sc">==</span> <span class="st">"Mandarine"</span>] <span class="ot">&lt;-</span> <span class="st">"Mandarin"</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-80" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-80-4" class="code-annotation-target"><a href="#annotated-cell-80-4" aria-hidden="true" tabindex="-1"></a>L2.data<span class="sc">$</span>NativeLg.cleaned.base[L2.data<span class="sc">$</span>NativeLg.cleaned.base <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Lithunanina"</span>, <span class="st">"Lituanian"</span>)] <span class="ot">&lt;-</span> <span class="st">"Lithuanian"</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-80" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-80" data-code-lines="1" data-code-annotation="1">With the first line, we extract the first string of letters before any space or slash in <code>NativeLg</code> and save this to a new variable called <code>NativeLg.cleaned.base</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-80" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-80" data-code-lines="2" data-code-annotation="2">This line converts all the values of the new variable to title case using a base <code>R</code> function from the {tools} package. The {tools} package comes with <code>R</code> so you don’t need to install it separately but, if you haven’t loaded it earlier in your <code>R</code> session, you need to call the function with the prefix <code>tools::</code> so that <code>R</code> knows where to find the <code>toTitleCase()</code> function.</span>
</dd>
<dt data-target-cell="annotated-cell-80" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-80" data-code-lines="3" data-code-annotation="3">The third line corrects a typo with a direct replacement.</span>
</dd>
<dt data-target-cell="annotated-cell-80" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-80" data-code-lines="4" data-code-annotation="4">This line replaces two typos with a single correction.</span>
</dd>
</dl>
</div>
</div>
<p>If we now compare the variable created with the tidyverse code (<code>NativeLg.cleaned</code>) vs.&nbsp;the one created using base R functions only (<code>NativeLg.cleaned.base</code>), we can see that they are exactly the same.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>L2.data <span class="sc">|&gt;</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NativeLg.cleaned, NativeLg.cleaned.base) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  NativeLg.cleaned NativeLg.cleaned.base
1       Lithuanian            Lithuanian
2           Polish                Polish
3           Polish                Polish
4          Italian               Italian
5       Lithuanian            Lithuanian
6           Polish                Polish</code></pre>
</div>
</div>
<p>An undeniable advantage of sticking to base <code>R</code> functions is that your code is more portable as it does not require the installation of any additional packages, keeping dependencies on external packages to the minimum. However, base <code>R</code> lacks the consistency of the tidyverse framework, which can make certain data transformation tasks considerably more tricky and code less readable (and therefore less transparent) to yourself and others.</p>
<p>As we don’t need two versions of the cleaned <code>NativLg</code> variable, we will now remove the <code>NativeLg.cleaned.base</code> column from <code>L2.data</code>. To do so, we use the <code>select()</code> function combined with the <code>-</code> operator to “unselect” the column we no longer need.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>L2.data <span class="ot">&lt;-</span> L2.data <span class="sc">|&gt;</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span> NativeLg.cleaned.base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your turn!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>For some analyses, it may be useful to group together participants whose native languages come from the same family of languages. For example, French, Spanish and Italian L1 speakers, may be considered as a one group of participants whose native language is a Romance language.</p>
<p>Use <code>mutate()</code> and <code>case_when()</code> to add a new variable to <code>L2.data</code> that corresponds to the L2 participant’s native language family. Call this new variable <code>NativeLgFamily</code>. Use the following language family categories:</p>
<ul>
<li>Baltic</li>
<li>Chinese</li>
<li>Germanic</li>
<li>Hellenic</li>
<li>Romance</li>
<li>Slavic</li>
</ul>
<p>If you’re not sure which language family a language belongs to, look it up on Wikipedia (e.g.&nbsp;the Wikipedia page on the <a href="https://en.wikipedia.org/wiki/German_language">German language</a> informs us in a text box at the top of the article that German is a Germanic language).</p>
<p><span style="color:green;"><strong>Q9.9</strong></span> Which language family is the <em>second</em> most represented among L2 participants’ native languages in <span class="citation" data-cites="DabrowskaExperienceAptitudeIndividual2019">Dąbrowska (<a href="99_references.html#ref-DabrowskaExperienceAptitudeIndividual2019" role="doc-biblioref">2019</a>)</span>?</p>
<div class="cell">
<div class="cell-output-display">
<form name="form_64746" onsubmit="return validate_form_64746()" method="post">
<label>
<input type="radio" name="answer_64746" id="answer_64746_1" value="Baltic">
Baltic
</label>
<br>
<label>
<input type="radio" name="answer_64746" id="answer_64746_2" value="Chinese">
Chinese
</label>
<br>
<label>
<input type="radio" name="answer_64746" id="answer_64746_3" value="Germanic">
Germanic
</label>
<br>
<label>
<input type="radio" name="answer_64746" id="answer_64746_4" value="Hellenic">
Hellenic
</label>
<br>
<label>
<input type="radio" name="answer_64746" id="answer_64746_5" value="Romance">
Romance
</label>
<br>
<label>
<input type="radio" name="answer_64746" id="answer_64746_6" value="Slavic">
Slavic
</label>
<br>
<input type="submit" value="Check answer">
<div id="result_64746"></div>
</form>
<script>function validate_form_64746() {var x, text; var x = document.forms['form_64746']['answer_64746'].value;if (x == 'Chinese'){text = '✅ That’s right, well done!';} else {text = 'No, have you checked that you have correctly classified all participants’ native languages?';} document.getElementById('result_64746').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1, res2, res3, res4, res5, res6, res7, res8, res9;res1 = document.getElementById('result_70985').innerText == 'That’s right!'; res2 = document.getElementById('result_25731').innerText == 'Correct, well done!'; res3 = document.getElementById('result_18811').innerText == 'That’s right!'; res4 = document.getElementById('result_66635').innerText == 'That’s right.'; res5 = document.getElementById('result_4220').innerText == 'Your intuition is correct (and this is confirmed by the author in the description of the L2 participants in the published paper).'; res6 = document.getElementById('result_25248').innerText == 'That’s right, well done! This trailing space needs to be removed otherwise R (and most other data analysis programmes) will consider this value to represent a fifth occupational category.'; res7 = document.getElementById('result_11643').innerText == 'That’s right! Now, use str_trim() to remove all trailing spaces in the OccupGroup variable. Check that you then have an L1 dataset with only four occupational categories.'; res8 = document.getElementById('result_51193').innerText == 'That’s right, well done!'; res9 = document.getElementById('result_64746').innerText == '✅ That’s right, well done!';text = res1 + res2 + res3 + res4 + res5 + res6 + res7 + res8 + res9;element.innerHTML = text;
         return false;
         }}</script>
</div>
<div class="cell-output-display">
<div id="hint_78344" onclick="return show_hint_78344()">🐭 Click on the mouse for a hint.</div>
<div id="result_78344" onclick="return show_hint_78344()"></div>
<script>function show_hint_78344(){var x = document.getElementById('result_78344').innerHTML; if(!x){document.getElementById('result_78344').innerHTML = 'Once you have created your new variable, use the <code>table()</code> or <code>count()</code> function to see the distribution of language families omong L2 participants.';} else {document.getElementById('result_78344').innerHTML = '';}}</script>
</div>
</div>
<p>&nbsp;</p>
<p><span style="color:green;"><strong>Q9.10</strong></span> How many L2 participants are native speakers of a language that belongs to the family of Romance languages?</p>
<div class="cell">
<div class="cell-output-display">
<form name="form_53435" onsubmit="return validate_form_53435()" method="post">
<input type="text" placeholder="" name="answer_53435">
<input type="submit" value="Check answer">
<div id="result_53435"></div>
</form>
<script>function validate_form_53435() {var x, text; var x = document.forms['form_53435']['answer_53435'].value;if (x == '6'|x == 'six'){text = '✅ Très bien! ¡Muy bien hecho! Ottimo!';} else {text = 'No, that’s incorrect. Check out the hint or, if you’re really stuck, the solution below.';} document.getElementById('result_53435').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1, res2, res3, res4, res5, res6, res7, res8, res9, res10;res1 = document.getElementById('result_70985').innerText == 'That’s right!'; res2 = document.getElementById('result_25731').innerText == 'Correct, well done!'; res3 = document.getElementById('result_18811').innerText == 'That’s right!'; res4 = document.getElementById('result_66635').innerText == 'That’s right.'; res5 = document.getElementById('result_4220').innerText == 'Your intuition is correct (and this is confirmed by the author in the description of the L2 participants in the published paper).'; res6 = document.getElementById('result_25248').innerText == 'That’s right, well done! This trailing space needs to be removed otherwise R (and most other data analysis programmes) will consider this value to represent a fifth occupational category.'; res7 = document.getElementById('result_11643').innerText == 'That’s right! Now, use str_trim() to remove all trailing spaces in the OccupGroup variable. Check that you then have an L1 dataset with only four occupational categories.'; res8 = document.getElementById('result_51193').innerText == 'That’s right, well done!'; res9 = document.getElementById('result_64746').innerText == '✅ That’s right, well done!'; res10 = document.getElementById('result_53435').innerText == '✅ Très bien! ¡Muy bien hecho! Ottimo!';text = res1 + res2 + res3 + res4 + res5 + res6 + res7 + res8 + res9 + res10;element.innerHTML = text;
         return false;
         }}</script>
</div>
<div class="cell-output-display">
<div id="hint_58877" onclick="return show_hint_58877()">🐭 Click on the mouse for a hint.</div>
<div id="result_58877" onclick="return show_hint_58877()"></div>
<script>function show_hint_58877(){var x = document.getElementById('result_58877').innerHTML; if(!x){document.getElementById('result_58877').innerHTML = 'Use the <code>count()</code> function as explained above to obtain a tally of the number of participants in each language family.';} else {document.getElementById('result_58877').innerHTML = '';}}</script>
</div>
</div>
<p>&nbsp;</p>
<p><span style="color:green;"><strong>Q9.11</strong></span> What percentage of L2 participants have a Slavic native language? Round your answer to the nearest percent.</p>
<div class="cell">
<div class="cell-output-display">
<form name="form_72712" onsubmit="return validate_form_72712()" method="post">
<input type="text" placeholder="" name="answer_72712">
<input type="submit" value="Check answer">
<div id="result_72712"></div>
</form>
<script>function validate_form_72712() {var x, text; var x = document.forms['form_72712']['answer_72712'].value;if (x == '58'|x == 'fifty-eight'|x == 'fifty eight'|x == '58%'|x == '58 %'|x == '58 percent'|x == 'fifty-eight percent'|x == 'fifty eight percent'){text = '✅ Yes, nice data wrangling job!';} else {text = 'No, that’s incorrect. First check the hint and, if you’re still stuck, take a look at the solution below.';} document.getElementById('result_72712').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1, res2, res3, res4, res5, res6, res7, res8, res9, res10, res11;res1 = document.getElementById('result_70985').innerText == 'That’s right!'; res2 = document.getElementById('result_25731').innerText == 'Correct, well done!'; res3 = document.getElementById('result_18811').innerText == 'That’s right!'; res4 = document.getElementById('result_66635').innerText == 'That’s right.'; res5 = document.getElementById('result_4220').innerText == 'Your intuition is correct (and this is confirmed by the author in the description of the L2 participants in the published paper).'; res6 = document.getElementById('result_25248').innerText == 'That’s right, well done! This trailing space needs to be removed otherwise R (and most other data analysis programmes) will consider this value to represent a fifth occupational category.'; res7 = document.getElementById('result_11643').innerText == 'That’s right! Now, use str_trim() to remove all trailing spaces in the OccupGroup variable. Check that you then have an L1 dataset with only four occupational categories.'; res8 = document.getElementById('result_51193').innerText == 'That’s right, well done!'; res9 = document.getElementById('result_64746').innerText == '✅ That’s right, well done!'; res10 = document.getElementById('result_53435').innerText == '✅ Très bien! ¡Muy bien hecho! Ottimo!'; res11 = document.getElementById('result_72712').innerText == '✅ Yes, nice data wrangling job!';text = res1 + res2 + res3 + res4 + res5 + res6 + res7 + res8 + res9 + res10 + res11;element.innerHTML = text;
         return false;
         }}</script>
</div>
<div class="cell-output-display">
<div id="hint_66987" onclick="return show_hint_66987()">🐭 Click on the mouse for a hint.</div>
<div id="result_66987" onclick="return show_hint_66987()"></div>
<script>function show_hint_66987(){var x = document.getElementById('result_66987').innerHTML; if(!x){document.getElementById('result_66987').innerHTML = 'You can copy the code from the previous section to add a “percent” column. Ensure that you adjust the correct argument in the <code>round()</code> function to obtain percentages rounded off the nearest percent.';} else {document.getElementById('result_66987').innerHTML = '';}}</script>
</div>
</div>
<p>&nbsp;</p>
<p><span style="color:green;"><strong>Q9.12</strong></span> If you check the output of <code>colnames(L2.data)</code> or <code>View(L2.data)</code>, you will see that the new variable that you created is now the last column in the table. Consult the help file of the {dplyr} function <code>relocate()</code> to work out how to place this column immediately after <code>NativeLg</code>.</p>
<div class="cell">
<div class="cell-output-display no-overflow-x">
<form name="form_90939" onsubmit="return validate_form_90939()" method="post">
<select name="answer_90939">
<option>L2.data &lt;- L2.data |&gt; relocate(NativeLgFamily, .after = NativeLg)</option>
<option>L2.data &lt;- L2.data |&gt; relocate(NativeLgFamily, .before = NativeLg)</option>
<option>L2.data &lt;- L2.data |&gt; relocate(NativeLgFamily, .after = NULL)</option>
<option>L2.data &lt;- L2.data |&gt; relocate(NativeLgFamily, after = NativeLg)</option>
<option>L2.data &lt;- L2.data |&gt; relocate(f, .after = NativeLg)</option>
</select>
<input type="submit" value="Check answer">
<div id="result_90939"></div>
</form>
<script>function validate_form_90939() {var x, text; var x = document.forms['form_90939']['answer_90939'].value;if (x == 'L2.data <- L2.data |> relocate(NativeLgFamily, .after = NativeLg)'){text = '✅  Nice work!';} else {text = 'No, that’s incorrect. If you’re really stuck, have a look at the solution below.';} document.getElementById('result_90939').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1, res2, res3, res4, res5, res6, res7, res8, res9, res10, res11, res12;res1 = document.getElementById('result_70985').innerText == 'That’s right!'; res2 = document.getElementById('result_25731').innerText == 'Correct, well done!'; res3 = document.getElementById('result_18811').innerText == 'That’s right!'; res4 = document.getElementById('result_66635').innerText == 'That’s right.'; res5 = document.getElementById('result_4220').innerText == 'Your intuition is correct (and this is confirmed by the author in the description of the L2 participants in the published paper).'; res6 = document.getElementById('result_25248').innerText == 'That’s right, well done! This trailing space needs to be removed otherwise R (and most other data analysis programmes) will consider this value to represent a fifth occupational category.'; res7 = document.getElementById('result_11643').innerText == 'That’s right! Now, use str_trim() to remove all trailing spaces in the OccupGroup variable. Check that you then have an L1 dataset with only four occupational categories.'; res8 = document.getElementById('result_51193').innerText == 'That’s right, well done!'; res9 = document.getElementById('result_64746').innerText == '✅ That’s right, well done!'; res10 = document.getElementById('result_53435').innerText == '✅ Très bien! ¡Muy bien hecho! Ottimo!'; res11 = document.getElementById('result_72712').innerText == '✅ Yes, nice data wrangling job!'; res12 = document.getElementById('result_90939').innerText == '✅  Nice work!';text = res1 + res2 + res3 + res4 + res5 + res6 + res7 + res8 + res9 + res10 + res11 + res12;element.innerHTML = text;
         return false;
         }}</script>
</div>
</div>
<p>&nbsp;</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click here for solutions to <span style="color:green;"><strong>Q9.9</strong></span>—<span style="color:green;"><strong>Q9.12</strong></span>.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>As always, there are several solutions to solving this <span style="color:green;"><strong>task</strong></span>. Here is one solution based on what we have covered so far in this chapter.</p>
<p><span style="color:green;"><strong>Q9.9</strong></span> Note that the following code will only work if you followed the instructions in the section above to create the <code>NativeLg.cleaned</code> variable as it relies on this variable to create the new <code>NativeLgFamily</code> variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>L2.data <span class="ot">&lt;-</span> L2.data <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NativeLgFamily =</span> <span class="fu">case_when</span>(</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    NativeLg.cleaned <span class="sc">==</span> <span class="st">"Lithuanian"</span> <span class="sc">~</span> <span class="st">"Baltic"</span>,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    NativeLg.cleaned <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cantonese"</span>, <span class="st">"Mandarin"</span>, <span class="st">"Chinese"</span>) <span class="sc">~</span> <span class="st">"Chinese"</span>,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    NativeLg.cleaned <span class="sc">==</span> <span class="st">"German"</span> <span class="sc">~</span> <span class="st">"Germanic"</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    NativeLg.cleaned <span class="sc">==</span> <span class="st">"Greek"</span> <span class="sc">~</span> <span class="st">"Hellenic"</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    NativeLg.cleaned <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"French"</span>, <span class="st">"Italian"</span>, <span class="st">"Spanish"</span>) <span class="sc">~</span> <span class="st">"Romance"</span>,</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    NativeLg.cleaned <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Polish"</span>, <span class="st">"Russian"</span>) <span class="sc">~</span> <span class="st">"Slavic"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As always, it is important to check that things have gone to plan.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>L2.data <span class="sc">|&gt;</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NativeLg.cleaned, NativeLgFamily)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  NativeLg.cleaned NativeLgFamily
1       Lithuanian         Baltic
2           Polish         Slavic
3           Polish         Slavic
4          Italian        Romance
5       Lithuanian         Baltic
6           Polish         Slavic</code></pre>
</div>
</div>
<p><span style="color:green;"><strong>Q9.10</strong></span> We can display the distribution of language families using either the base <code>R</code> <code>table()</code> function or the {tidyverse} <code>count()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(L2.data<span class="sc">$</span>NativeLgFamily)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>
  Baltic  Chinese Germanic Hellenic  Romance   Slavic 
       5       15        1        1        6       39 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb67" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>L2.data <span class="sc">|&gt;</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(NativeLgFamily)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  NativeLgFamily  n
1         Baltic  5
2        Chinese 15
3       Germanic  1
4       Hellenic  1
5        Romance  6
6         Slavic 39</code></pre>
</div>
</div>
<p><span style="color:green;"><strong>Q9.11</strong></span> We can add a column to show the distribution in percentages by adding a new “percent” column to the <code>count()</code> table using <code>mutate()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-88" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-88" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-88-1" class="code-annotation-target"><a href="#annotated-cell-88-1" aria-hidden="true" tabindex="-1"></a>L2.data <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-88" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-88-2" class="code-annotation-target"><a href="#annotated-cell-88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(NativeLgFamily) <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-88" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-88-3" class="code-annotation-target"><a href="#annotated-cell-88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-88" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-88-4" class="code-annotation-target"><a href="#annotated-cell-88-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">percent =</span> percent<span class="sc">*</span><span class="dv">100</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-88" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-88-5" class="code-annotation-target"><a href="#annotated-cell-88-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">percent =</span> <span class="fu">round</span>(percent, <span class="at">digits =</span> <span class="dv">0</span>)</span>
<span id="annotated-cell-88-6"><a href="#annotated-cell-88-6" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-88" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-88-7" class="code-annotation-target"><a href="#annotated-cell-88-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-88" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-88" data-code-lines="1" data-code-annotation="1">We start with the dataset that contains the new <code>NativeLgFamily</code> variable.</span>
</dd>
<dt data-target-cell="annotated-cell-88" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-88" data-code-lines="2" data-code-annotation="2">We pipe it into the <code>count()</code> function. As shown above, this function produces a frequency table with counts stored in the variable <code>n</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-88" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-88" data-code-lines="3" data-code-annotation="3">We divide the number of participant with each native language (<code>n</code>) by the total number of participants (<code>sum(n)</code>). We obtain proportions ranging from 0 to 1.</span>
</dd>
<dt data-target-cell="annotated-cell-88" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-88" data-code-lines="4" data-code-annotation="4">We multiply these by 100 to get percentages.</span>
</dd>
<dt data-target-cell="annotated-cell-88" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-88" data-code-lines="5" data-code-annotation="5">We round the percentages to two decimal places.</span>
</dd>
<dt data-target-cell="annotated-cell-88" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-88" data-code-lines="7" data-code-annotation="6">We reorder the table so that the most represented group is at the top. To do so, we pipe our table into the <code>dplyr::arrange()</code>. By default, <code>arrange()</code> orders values in ascending order (from smallest to largest); hence, we add the <code>desc()</code> function to sort the table in descending order of frequency.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  NativeLgFamily  n percent
1         Slavic 39      58
2        Chinese 15      22
3        Romance  6       9
4         Baltic  5       7
5       Germanic  1       1
6       Hellenic  1       1</code></pre>
</div>
</div>
<p>🪐 Note that this a {tidyverse} approach to working out percentages, see <a href="8_DescriptiveStats.html#sec-Mode" class="quarto-xref"><span>Section 8.1.3</span></a> for a base <code>R</code> approach.</p>
<p><span style="color:green;"><strong>Q9.12</strong></span> At the time of writing, the help file of the <code>relocate()</code> function still featured examples using the {magrittr} pipe (<code>%&gt;%</code>) rather than the native <code>R</code> pipe (<code>|&gt;</code>) (see <a href="7_VariablesFunctions.html#sec-Piping" class="quarto-xref"><span>Section 7.5.2</span></a>), but the syntax remains the same. The first argument is the data which we are piping into the function, the second argument is the column that we want to move. Then, we need to specify where to with either the “.after” or the “.before” argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>L2.data <span class="ot">&lt;-</span> L2.data <span class="sc">|&gt;</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(NativeLgFamily, <span class="at">.after =</span> NativeLg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-relocate" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Cartoon of fuzzy monsters moving columns around in fork lifts, while one supervises. Stylized text reads “dplyr::relocate() - move columns around! Default: move to FRONT , or move to .before or .after a specified column.”">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-relocate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/AHorst_relocate.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Figure&nbsp;9.7: Artwork explaining the dplyr::relocate() function by @allison_horst."><img src="images/AHorst_relocate.png" class="img-fluid figure-img" alt="Cartoon of fuzzy monsters moving columns around in fork lifts, while one supervises. Stylized text reads “dplyr::relocate() - move columns around! Default: move to FRONT , or move to .before or .after a specified column.”"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-relocate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.7: Artwork explaining the <code>dplyr::relocate()</code> function by <a href="https://allisonhorst.com/allison-horst">@allison_horst</a>.
</figcaption>
</figure>
</div>
<p>Note that the help file specifies that both “.after” and “.before” begin with a dot. If you leave the dot out, the function will not work as expected! Can you see what’s happened here?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>L2.data <span class="sc">|&gt;</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(NativeLgFamily, <span class="at">after =</span> NativeLg) <span class="sc">|&gt;</span> </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>'data.frame':   67 obs. of  6 variables:
 $ NativeLgFamily: chr  "Baltic" "Slavic" "Slavic" "Romance" ...
 $ after         : chr  "Lithuanian" "polish" "Polish" "Italian" ...
 $ Participant   : int  220 244 46 221 222 230 247 237 243 213 ...
 $ Gender        : chr  "F" "f" "F" "F" ...
 $ Occupation    : chr  "Student" "student" "Cleaner" "Student" ...
 $ OccupGroup    : chr  "PS" "PS" "M" "PS" ...</code></pre>
</div>
</div>
<p>The <code>relocate()</code> function has moved <code>NativeLgFamily</code> to the first column (the function’s default position) and has also moved <code>NativeLg</code> to the second position, but it has renamed the column <code>after</code>.</p>
<p>This is a reminder to <em>always</em> check whether your data wrangling operations have gone as planned. Just because you didn’t get an error message doesn’t mean that your code did what you wanted! ⚠️</p>
</div>
</div>
</div>
</section>
</section>
<section id="sec-CombiningDatasets" class="level2 page-columns page-full" data-number="9.7">
<h2 data-number="9.7" class="anchored" data-anchor-id="sec-CombiningDatasets"><span class="header-section-number">9.7</span> Combining datasets</h2>
<p>So far, we have analysed the L1 and L2 datasets individually. In the following chapters, however, we will conduct comparative analyses, comparing the performance of the L1 and L2 participants in the various language-related tests conduced as part of <span class="citation" data-cites="DabrowskaExperienceAptitudeIndividual2019">Dąbrowska (<a href="99_references.html#ref-DabrowskaExperienceAptitudeIndividual2019" role="doc-biblioref">2019</a>)</span>. To this end, we need to create a combined table that includes the data of all participants from <span class="citation" data-cites="DabrowskaExperienceAptitudeIndividual2019">Dąbrowska (<a href="99_references.html#ref-DabrowskaExperienceAptitudeIndividual2019" role="doc-biblioref">2019</a>)</span>.</p>
<p>Remember that both tables, <code>L1.data</code> and <code>L2.data</code>, are in a tidy data format. This means that:</p>
<ul>
<li>each row represents an observation (i.e., here, a participant),</li>
<li>each cell represents a measurement, and</li>
<li>each variable forms a column.</li>
</ul>
<p>To combine the two datasets, therefore, we need to combine the rows of the two tables. However, we cannot simply add the rows of the <code>L2.data</code> table to the bottom of <code>L1.data</code> table because, as shown below, the two tables do not have the same number of columns and the shared columns are not in the same position! We therefore need to ensure that, when the two datasets are combined, the shared columns are aligned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(L1.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1] "Participant" "Age"         "Gender"      "Occupation"  "OccupGroup" 
 [6] "OtherLgs"    "Education"   "EduYrs"      "ReadEng1"    "ReadEng2"   
[11] "ReadEng3"    "ReadEng"     "Active"      "ObjCl"       "ObjRel"     
[16] "Passive"     "Postmod"     "Q.has"       "Q.is"        "Locative"   
[21] "SubCl"       "SubRel"      "GrammarR"    "Grammar"     "VocabR"     
[26] "Vocab"       "CollocR"     "Colloc"      "Blocks"      "ART"        
[31] "LgAnalysis"  "Gender.fct" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(L2.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1] "Participant"      "Gender"           "Occupation"       "OccupGroup"      
 [5] "NativeLg"         "NativeLgFamily"   "OtherLgs"         "EdNative"        
 [9] "EdUK"             "Age"              "EduYrsNat"        "EduYrsEng"       
[13] "EduTotal"         "FirstExp"         "Arrival"          "LoR"             
[17] "EngWork"          "EngPrivate"       "ReadEng1"         "ReadOth1"        
[21] "ReadEng2"         "ReadOth2"         "ReadEng3"         "ReadOth3"        
[25] "ReadEng"          "ReadOth"          "Active"           "ObjCl"           
[29] "ObjRel"           "Passive"          "Postmod"          "Q.has"           
[33] "Q.is"             "Locative"         "SubCl"            "SubRel"          
[37] "GrammarR"         "Grammar"          "VocabR"           "Vocab"           
[41] "CollocR"          "Colloc"           "Blocks"           "ART"             
[45] "LgAnalysis"       "UseEngC"          "NativeLg.cleaned"</code></pre>
</div>
</div>
<p>Note, also, that participants’ total number of years in education is stored in the <code>EduYrs</code> column in <code>L1.data</code>, whereas the corresponding column in <code>L2.data</code> is called <code>EduTotal</code>. Hence, we first use the {dplyr} function <code>rename()</code> to rename <code>EduYrs</code> in <code>L1.data</code> as <code>EduTotal</code> before we merge the two tables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>L1.data <span class="ot">&lt;-</span> L1.data <span class="sc">|&gt;</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">EduTotal =</span> EduYrs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The {dplyr} package boasts an array of useful functions to combine tables (see <a href="#fig-dplyrcheatsheet" class="quarto-xref">Figure&nbsp;<span>9.8</span></a>). For our purposes, <code>bind_rows()</code> appears to be the perfect function.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div id="fig-dplyrcheatsheet" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Extract from dplyr cheatsheet showing all the &quot;join&quot; functions. Screenreader friendly version can be found here: https://rstudio.github.io/cheatsheets/html/data-transformation.html" data-out-width="80%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dplyrcheatsheet-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/dplyr_cheatsheet_extract.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11" title="Figure&nbsp;9.8: Extract of the data transformation with {dplyr} cheatsheet (CC BY SA Posit Software, PBC)"><img src="images/dplyr_cheatsheet_extract.png" class="img-fluid figure-img" data-out-width="80%" alt="Extract from dplyr cheatsheet showing all the &quot;join&quot; functions. Screenreader friendly version can be found here: https://rstudio.github.io/cheatsheets/html/data-transformation.html"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dplyrcheatsheet-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.8: Extract of the <a href="https://rstudio.github.io/cheatsheets/data-transformation.pdf">data transformation with {dplyr} cheatsheet</a> (CC BY SA Posit Software, PBC)
</figcaption>
</figure>
</div>
<p>However, when we try to combine <code>L1.data</code> and <code>L2.data</code> using <code>bind_rows()</code>, we get an error message… 😢 Does this error remind you of Q10 from <a href="7_VariablesFunctions.html#sec-DataTypes" class="quarto-xref"><span>Section 7.2.3</span></a> by any chance?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>combined.data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(L1.data, L2.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre data-code-line-numbers=""><code>Error in `bind_rows()`:
! Can't combine `..1$Participant` &lt;character&gt; and `..2$Participant` &lt;integer&gt;.</code></pre>
<p>What this error message tells us is that the <code>bind_rows()</code> function cannot combine the two <code>Participant</code> columns because in <code>L1.data</code> it is a string character vector, whereas in <code>L2.data</code> it is an integer vector. However, to avoid data loss, <code>bind_rows()</code> can only match columns of the same data type!</p>
<p>We must therefore first convert the <code>Participant</code> variable in <code>L2.data</code> to a character vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>L2.data <span class="ot">&lt;-</span> L2.data <span class="sc">|&gt;</span> </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Participant =</span> <span class="fu">as.character</span>(Participant))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we can combine the two data frames using <code>bind_rows()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>combined.data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(L1.data, L2.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The problem is that now that we have merged our two datasets into one, it’s not obvious which rows correspond to L1 participants and which to L2 participants! There are various ways to solve this, but here’s a simple <strong>three-step solution</strong> that relies exclusively on functions that you are already familiar with.</p>
<p><strong>Step 1:</strong> We add a new column to <code>L1.data</code> called <code>Group</code> and fill this column with the value “L1” for all rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>L1.data <span class="ot">&lt;-</span> L1.data <span class="sc">|&gt;</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Group =</span> <span class="st">"L1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 2:</strong> We add a new column to <code>L2.data</code> also called <code>Group</code> and fill this column with the value “L2” for all rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>L2.data <span class="ot">&lt;-</span> L2.data <span class="sc">|&gt;</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Group =</span> <span class="st">"L2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 3:</strong> We use <code>bind_rows()</code> as above to combine the two datasets that now both include the extra <code>Group</code> column.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>combined.data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(L1.data, L2.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Verification step:</strong> The <code>combined.data</code> table now includes the column <code>Group</code>, which we can use to easily identify the observations that belong to L1 and L2 participants. As expected, our combined dataset includes 90 participants from the L1 group and 67 from the L2 group:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>combined.data <span class="sc">|&gt;</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  Group  n
1    L1 90
2    L2 67</code></pre>
</div>
</div>
<p>Our combined dataset contains all the columns that appear in either <code>L1.data</code> or <code>L2.data</code>. Check that this is the case by examining the structure of the new dataset with <code>str(combined.data)</code>.</p>
<p>You will have noticed that, in some columns, there are lots of <code>NA</code> (“Not Available”) values. These represent <strong>missing data</strong>. <code>R</code> has inserted these <code>NA</code> values in the columns that only appear in one of the two datasets. For example, the L1 dataset does not include an <code>Arrival</code> variable (indicating the age when participants first arrived in an English-speaking country), presumably because they were all <em>born</em> in an English-speaking country! We only have this information for the L2 participants and this explains the 90 <code>NA</code> values in the <code>Arrival</code> column of the combined dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>combined.data<span class="sc">$</span>Arrival</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
 [26] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
 [51] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
 [76] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA 17 18 19 19 19 19 20 22 22 23
[101] 24 25 26 26 28 28 30 44 45 49 17 23 23 24 19 22 23 26 16 18 24 24 25 29 30
[126] 32 33 22 25 30 44 27 18 20 21 33 38 47 16 19 20 24 25 28 33 20 22 25 28 26
[151] 26 16 24 32 20 16 20</code></pre>
</div>
</div>
<p>We can also check this by cross-tabulating the <code>Group</code> and the <code>Arrival</code> variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>combined.data <span class="sc">|&gt;</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Group, Arrival)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  Group Arrival  n
1    L1      NA 90
2    L2      16  4
3    L2      17  2
4    L2      18  3
5    L2      19  6
6    L2      20  6</code></pre>
</div>
</div>
<p>Run <code>View(combined.data)</code> to inspect the combined dataset and check in which other columns there are <code>NA</code> values.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What if my data are not yet in tidy format? 🤨
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Combining the two datasets from <span class="citation" data-cites="DabrowskaExperienceAptitudeIndividual2019">Dąbrowska (<a href="99_references.html#ref-DabrowskaExperienceAptitudeIndividual2019" role="doc-biblioref">2019</a>)</span> was relatively easy because the data was already in tidy format. But, fear not: if you need to first convert your data to tidy format, the <a href="https://tidyr.tidyverse.org/">{tidyr}</a> package has got you covered! 😎</p>
<p>The <code>pivot_longer()</code> and <code>pivot_wider()</code> functions allow you to easily convert tables from “long” to “wide” format and vice versa (see <a href="#fig-tidyrcheatsheet" class="quarto-xref">Figure&nbsp;<span>9.9</span></a>).</p>
<div id="fig-tidyrcheatsheet" class="quarto-float quarto-figure quarto-figure-center anchored" alt="pivot_longer(data, cols, names_to = &quot;name&quot;, values_to = &quot;value&quot;, values_drop_na = FALSE) &quot;Lengthen&quot; data by collapsing several columns into two. Column names move to a new names_to column and values to a new values_to column. pivot_longer(table4a, cols = 2:3, names_to =&quot;year&quot;, values_to = &quot;cases&quot;) pivot_wider(data, names_from = &quot;name&quot;, values_from = &quot;value&quot;) The inverse of pivot_longer(). &quot;Widen&quot; data by expanding two columns into several. One column provides the new column names, the other the values. pivot_wider(table2, names_from = type, values_from = count)" data-out-width="60%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tidyrcheatsheet-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/tidyr_cheatsheet_extract.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12" title="Figure&nbsp;9.9: Extract of the data tidying with tidyr cheatsheet (CC BY SA Posit Software, PBC)"><img src="images/tidyr_cheatsheet_extract.png" class="img-fluid figure-img" data-out-width="60%" alt="pivot_longer(data, cols, names_to = &quot;name&quot;, values_to = &quot;value&quot;, values_drop_na = FALSE) &quot;Lengthen&quot; data by collapsing several columns into two. Column names move to a new names_to column and values to a new values_to column. pivot_longer(table4a, cols = 2:3, names_to =&quot;year&quot;, values_to = &quot;cases&quot;) pivot_wider(data, names_from = &quot;name&quot;, values_from = &quot;value&quot;) The inverse of pivot_longer(). &quot;Widen&quot; data by expanding two columns into several. One column provides the new column names, the other the values. pivot_wider(table2, names_from = type, values_from = count)"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidyrcheatsheet-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.9: Extract of the <a href="https://github.com/rstudio/cheatsheets/blob/main/tidyr.pdf">data tidying with tidyr cheatsheet</a> (CC BY SA Posit Software, PBC)
</figcaption>
</figure>
</div>

<p>Remember to carefully check the output of any data manipulation that you do <em>before</em> moving on to doing any analyses! To this end, the <code>View()</code> function is particularly helpful.</p>
</div>
</div>
</div>
<div class="no-row-height column-margin column-container"><div class="callout-10-contents callout-collapse collapse callout-margin-content">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/hex_tidyr.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13" title="Hex sticker of the {tidyr} package"><img src="images/hex_tidyr.png" class="img-fluid figure-img" width="100" alt="Hex sticker of the {tidyr} package"></a></p>
<figcaption>Hex sticker of the <a href="https://tidyr.tidyverse.org/">{tidyr}</a> package</figcaption>
</figure>
</div>
</div></div><div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Using AI tools for coding ⚠️
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that older textbooks/tutorials, and especially AI tools such as ChatGPT that have been trained on older web data, will frequently suggest <strong>superseded</strong> (i.e.&nbsp;outdated) functions for data manipulation such as <code>spread()</code>, <code>gather()</code>, <code>select_all()</code>, and <code>mutate_if()</code>. If you use superseded functions, your code will still work, but <code>R</code> will print a warning in the Console and usually suggest a modern alternative.</p>
<p>AI tools may also suggest using functions that are <strong>deprecated</strong>. As with superseded functions, you will get a warning message with a recommended alternative. In this case, however, you must follow the advice of the warning, as writing new code with deprecated functions is really asking for trouble! Deprecated functions are scheduled for removal, which means that your code will eventually no longer run on up-to-date <code>R</code> versions.</p>
<div id="fig-lifecycle" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lifecycle-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/lifecycle.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-14" title="Figure&nbsp;9.10: The four main stages of the lifecycle of R packages, functions, function arguments: experimental developments can become stable and stable can eventually become deprecated or superseded (image by Henry and Wickham 2023 for Posit Software, PBC, https://lifecycle.r-lib.org/articles/stages.html)."><img src="images/lifecycle.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lifecycle-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.10: The four main stages of the lifecycle of <code>R</code> packages, functions, function arguments: <strong>experimental</strong> developments can become <strong>stable</strong> and stable can eventually become <strong>deprecated</strong> or <strong>superseded</strong> (image by Henry and Wickham 2023 for Posit Software, PBC, <a href="https://lifecycle.r-lib.org/articles/stages.html" class="uri">https://lifecycle.r-lib.org/articles/stages.html</a>).
</figcaption>
</figure>
</div>
<p>In sum, to ensure the future compatibility of your code, do not ignore warnings about deprecated functions and, in general, <em>never ever</em> blindly trust the output of AI tools!</p>
</div>
</div>
</section>
<section id="sec-filter" class="level2" data-number="9.8">
<h2 data-number="9.8" class="anchored" data-anchor-id="sec-filter"><span class="header-section-number">9.8</span> A pre-processing pipeline</h2>
<p>So far in this chapter, we have learnt how to pre-process data for future statistical analyses and data visualisation. In the process, we have learnt about lots of different functions, mostly from the tidyverse environment (see <a href="#sec-tidyverse" class="quarto-xref"><span>Section 9.1</span></a> 🪐). Now it’s time to put everything together and save our pre-processed combined dataset for future use.</p>
<p>But, first, let’s recap all of the data wrangling operations that we performed in this chapter and combine them into one code chunk. Before running this code, we first reload the original data from <span class="citation" data-cites="DabrowskaExperienceAptitudeIndividual2019">Dąbrowska (<a href="99_references.html#ref-DabrowskaExperienceAptitudeIndividual2019" role="doc-biblioref">2019</a>)</span> to overwrite any changes that were made during this chapter. This will ensure that we all have exactly the same version of the dataset for the following chapters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>L1.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"L1_data.csv"</span>))</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>L2.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"L2_data.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, run the following lines of code to create a new <code>R</code> object called <code>combined.data</code> that contains the wrangled data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>L2.data <span class="ot">&lt;-</span> L2.data <span class="sc">|&gt;</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Participant =</span> <span class="fu">as.character</span>(Participant)) <span class="sc">|&gt;</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Group =</span> <span class="st">"L2"</span>)  </span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>L1.data <span class="ot">&lt;-</span> L1.data <span class="sc">|&gt;</span> </span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Group =</span> <span class="st">"L1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">EduTotal =</span> EduYrs)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>combined.data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(L1.data, L2.data) <span class="sc">|&gt;</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), str_to_title)) <span class="sc">|&gt;</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), str_trim)) <span class="sc">|&gt;</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OccupGroup =</span> <span class="fu">str_to_upper</span>(OccupGroup)) <span class="sc">|&gt;</span> </span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">NativeLg =</span> <span class="fu">word</span>(NativeLg, <span class="at">start =</span> <span class="dv">1</span>),</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">NativeLg =</span> <span class="fu">word</span>(NativeLg, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">sep =</span> <span class="fu">fixed</span>(<span class="st">"/"</span>)),</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">NativeLg =</span> <span class="fu">case_when</span>(</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>      NativeLg <span class="sc">==</span> <span class="st">"Mandarine"</span> <span class="sc">~</span> <span class="st">"Mandarin"</span>,</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>      NativeLg <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Lithunanina"</span>, <span class="st">"Lithunanina"</span>, <span class="st">"Lituanian"</span>) <span class="sc">~</span> <span class="st">"Lithuanian"</span>,</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> NativeLg)) <span class="sc">|&gt;</span> </span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NativeLgFamily =</span> <span class="fu">case_when</span>(</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>    NativeLg <span class="sc">==</span> <span class="st">"Lithuanian"</span> <span class="sc">~</span> <span class="st">"Baltic"</span>,</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>    NativeLg <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cantonese"</span>, <span class="st">"Mandarin"</span>, <span class="st">"Chinese"</span>) <span class="sc">~</span> <span class="st">"Chinese"</span>,</span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>    NativeLg <span class="sc">==</span> <span class="st">"German"</span> <span class="sc">~</span> <span class="st">"Germanic"</span>,</span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>    NativeLg <span class="sc">==</span> <span class="st">"Greek"</span> <span class="sc">~</span> <span class="st">"Hellenic"</span>,</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>    NativeLg <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"French"</span>, <span class="st">"Italian"</span>, <span class="st">"Spanish"</span>) <span class="sc">~</span> <span class="st">"Romance"</span>,</span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>    NativeLg <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Polish"</span>, <span class="st">"Russian"</span>) <span class="sc">~</span> <span class="st">"Slavic"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), factor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Don’t forgot to check the result by examining the output of <code>View(combined.data)</code> and <code>str(combined.data)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(combined.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  Participant       Age        Gender             Occupation OccupGroup
 1      :  1   Min.   :17.00   F:94   Student          :27   C :32     
 100    :  1   1st Qu.:25.00   M:63   Retired          :15   I :26     
 101    :  1   Median :31.00          Product Operative: 5   M :41     
 104    :  1   Mean   :35.48          Teacher          : 5   PS:58     
 106    :  1   3rd Qu.:42.00          Cleaner          : 4             
 107    :  1   Max.   :65.00          Unemployed       : 4             
 (Other):151                          (Other)          :97             
              OtherLgs    Education     EduTotal        ReadEng1    
 None             :98   Student: 8   Min.   : 8.50   Min.   :0.000  
 No               :11   A Level: 5   1st Qu.:13.00   1st Qu.:1.000  
 English          : 8   Ba     : 5   Median :14.00   Median :3.000  
 German           : 6   Gcses  : 5   Mean   :14.62   Mean   :2.599  
 English At School: 3   Nvq    : 4   3rd Qu.:17.00   3rd Qu.:4.000  
 English, German  : 2   (Other):63   Max.   :24.00   Max.   :5.000  
 (Other)          :29   NA's   :67                                  
    ReadEng2        ReadEng3        ReadEng      
 Min.   :0.000   Min.   :0.000   Min.   : 0.000  
 1st Qu.:1.000   1st Qu.:1.000   1st Qu.: 5.000  
 Median :2.000   Median :2.000   Median : 7.000  
 Mean   :2.465   Mean   :2.019   Mean   : 7.083  
 3rd Qu.:3.000   3rd Qu.:3.000   3rd Qu.:10.000  
 Max.   :5.000   Max.   :4.000   Max.   :14.000  
                                                 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your turn!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p><span style="color:green;"><strong>Q9.13</strong></span> The following operations describe the steps performed by the data wrangling code chunk above. In which order are the operations performed?</p>
<div class="cell">
<div class="cell-output-display">
<form name="form_32227" onsubmit="return validate_form_32227()" method="post">
<table data-quarto-disable-processing="true">
<tbody id="task_32227">
<tr>
<td id="answer_32227_3" style="padding:5px; border:1px solid #ccc;">Change the name of one variable</td>
</tr>
<tr>
<td style="padding:5px">
<button type="button" onclick="swapElementsV(this);">⇅</button>
</td>
</tr>
<tr>
<td id="answer_32227_8" style="padding:5px; border:1px solid #ccc;">Shorten and correct typos in the values of one variable.</td>
</tr>
<tr>
<td style="padding:5px">
<button type="button" onclick="swapElementsV(this);">⇅</button>
</td>
</tr>
<tr>
<td id="answer_32227_7" style="padding:5px; border:1px solid #ccc;">Convert all the values of one variable to upper case.</td>
</tr>
<tr>
<td style="padding:5px">
<button type="button" onclick="swapElementsV(this);">⇅</button>
</td>
</tr>
<tr>
<td id="answer_32227_9" style="padding:5px; border:1px solid #ccc;">Add a new variable based on another variable.</td>
</tr>
<tr>
<td style="padding:5px">
<button type="button" onclick="swapElementsV(this);">⇅</button>
</td>
</tr>
<tr>
<td id="answer_32227_5" style="padding:5px; border:1px solid #ccc;">Convert the values of all character variables to title case.</td>
</tr>
<tr>
<td style="padding:5px">
<button type="button" onclick="swapElementsV(this);">⇅</button>
</td>
</tr>
<tr>
<td id="answer_32227_1" style="padding:5px; border:1px solid #ccc;">Convert one variable to a character variable.</td>
</tr>
<tr>
<td style="padding:5px">
<button type="button" onclick="swapElementsV(this);">⇅</button>
</td>
</tr>
<tr>
<td id="answer_32227_2" style="padding:5px; border:1px solid #ccc;">Add two new variables that each have all the same values.</td>
</tr>
<tr>
<td style="padding:5px">
<button type="button" onclick="swapElementsV(this);">⇅</button>
</td>
</tr>
<tr>
<td id="answer_32227_4" style="padding:5px; border:1px solid #ccc;">Merge data from the two datasets into one.</td>
</tr>
<tr>
<td style="padding:5px">
<button type="button" onclick="swapElementsV(this);">⇅</button>
</td>
</tr>
<tr>
<td id="answer_32227_6" style="padding:5px; border:1px solid #ccc;">Remove whitespace at the start and end of all values in all character variables.</td>
</tr>
<tr>
<td style="padding:5px">
<button type="button" onclick="swapElementsV(this);">⇅</button>
</td>
</tr>
<tr>
<td id="answer_32227_10" style="padding:5px; border:1px solid #ccc;">Convert all character string vectors to factors.</td>
</tr>
</tbody>
</table>
<input type="submit" value="Check answer">
<div id="result_32227"></div>
</form>
<script>function validate_form_32227() {var text;var ch = document.getElementById('task_32227').children; if(ch[0].children[0].id == 'answer_32227_1'&ch[2].children[0].id == 'answer_32227_2'&ch[4].children[0].id == 'answer_32227_3'&ch[6].children[0].id == 'answer_32227_4'&ch[8].children[0].id == 'answer_32227_5'&ch[10].children[0].id == 'answer_32227_6'&ch[12].children[0].id == 'answer_32227_7'&ch[14].children[0].id == 'answer_32227_8'&ch[16].children[0].id == 'answer_32227_9'&ch[18].children[0].id == 'answer_32227_10'){text = 'Perfect! 🎉';} else {text = 'No, not quite.';} document.getElementById('result_32227').innerHTML = text; evaluate_final_score(); return false;}function swapElementsV(element) {const parent = element.parentNode.parentNode; const afterNode = parent.nextElementSibling; const beforeNode = parent.previousElementSibling; parent.insertAdjacentElement('beforebegin', afterNode); parent.insertAdjacentElement('afterend', beforeNode);}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1, res2, res3, res4, res5, res6, res7, res8, res9, res10, res11, res12, res13;res1 = document.getElementById('result_70985').innerText == 'That’s right!'; res2 = document.getElementById('result_25731').innerText == 'Correct, well done!'; res3 = document.getElementById('result_18811').innerText == 'That’s right!'; res4 = document.getElementById('result_66635').innerText == 'That’s right.'; res5 = document.getElementById('result_4220').innerText == 'Your intuition is correct (and this is confirmed by the author in the description of the L2 participants in the published paper).'; res6 = document.getElementById('result_25248').innerText == 'That’s right, well done! This trailing space needs to be removed otherwise R (and most other data analysis programmes) will consider this value to represent a fifth occupational category.'; res7 = document.getElementById('result_11643').innerText == 'That’s right! Now, use str_trim() to remove all trailing spaces in the OccupGroup variable. Check that you then have an L1 dataset with only four occupational categories.'; res8 = document.getElementById('result_51193').innerText == 'That’s right, well done!'; res9 = document.getElementById('result_64746').innerText == '✅ That’s right, well done!'; res10 = document.getElementById('result_53435').innerText == '✅ Très bien! ¡Muy bien hecho! Ottimo!'; res11 = document.getElementById('result_72712').innerText == '✅ Yes, nice data wrangling job!'; res12 = document.getElementById('result_90939').innerText == '✅  Nice work!'; res13 = document.getElementById('result_32227').innerText == 'Perfect! 🎉';text = res1 + res2 + res3 + res4 + res5 + res6 + res7 + res8 + res9 + res10 + res11 + res12 + res13;element.innerHTML = text;
         return false;
         }}</script>
</div>
<div class="cell-output-display">
<div id="hint_1431" onclick="return show_hint_1431()">🐭 Click on the mouse for a hint.</div>
<div id="result_1431" onclick="return show_hint_1431()"></div>
<script>function show_hint_1431(){var x = document.getElementById('result_1431').innerHTML; if(!x){document.getElementById('result_1431').innerHTML = 'Use the up and down arrows to swap the order of any two labels in the list.The first three operations are:<ol><li>Convert one variable to a character variable.</li><li>Add two new variables that each have all the same values.</li><li>Change the name of one variable.</li></ol>';} else {document.getElementById('result_1431').innerHTML = '';}}</script>
</div>
</div>
<p>&nbsp;</p>
<p><span style="color:green;"><strong>Q9.14</strong></span> In the combined dataset, how many participants have a clerical occupation?</p>
<div class="cell">
<div class="cell-output-display">
<form name="form_60086" onsubmit="return validate_form_60086()" method="post">
<input type="text" placeholder="" name="answer_60086">
<input type="submit" value="Check answer">
<div id="result_60086"></div>
</form>
<script>function validate_form_60086() {var x, text; var x = document.forms['form_60086']['answer_60086'].value;if (x == '32'|x == 'thirty-two'|x == 'thirty two'){text = '✅';} else {text = '❌';} document.getElementById('result_60086').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1, res2, res3, res4, res5, res6, res7, res8, res9, res10, res11, res12, res13, res14;res1 = document.getElementById('result_70985').innerText == 'That’s right!'; res2 = document.getElementById('result_25731').innerText == 'Correct, well done!'; res3 = document.getElementById('result_18811').innerText == 'That’s right!'; res4 = document.getElementById('result_66635').innerText == 'That’s right.'; res5 = document.getElementById('result_4220').innerText == 'Your intuition is correct (and this is confirmed by the author in the description of the L2 participants in the published paper).'; res6 = document.getElementById('result_25248').innerText == 'That’s right, well done! This trailing space needs to be removed otherwise R (and most other data analysis programmes) will consider this value to represent a fifth occupational category.'; res7 = document.getElementById('result_11643').innerText == 'That’s right! Now, use str_trim() to remove all trailing spaces in the OccupGroup variable. Check that you then have an L1 dataset with only four occupational categories.'; res8 = document.getElementById('result_51193').innerText == 'That’s right, well done!'; res9 = document.getElementById('result_64746').innerText == '✅ That’s right, well done!'; res10 = document.getElementById('result_53435').innerText == '✅ Très bien! ¡Muy bien hecho! Ottimo!'; res11 = document.getElementById('result_72712').innerText == '✅ Yes, nice data wrangling job!'; res12 = document.getElementById('result_90939').innerText == '✅  Nice work!'; res13 = document.getElementById('result_32227').innerText == 'Perfect! 🎉'; res14 = document.getElementById('result_60086').innerText == '✅';text = res1 + res2 + res3 + res4 + res5 + res6 + res7 + res8 + res9 + res10 + res11 + res12 + res13 + res14;element.innerHTML = text;
         return false;
         }}</script>
</div>
<div class="cell-output-display">
<div id="hint_2593" onclick="return show_hint_2593()">🐭 Click on the mouse for a hint.</div>
<div id="result_2593" onclick="return show_hint_2593()"></div>
<script>function show_hint_2593(){var x = document.getElementById('result_2593').innerHTML; if(!x){document.getElementById('result_2593').innerHTML = 'Have you tried using the <code>summary()</code> function to look into the <code>OccupGroup</code> variable of <code>combined.data</code>?';} else {document.getElementById('result_2593').innerHTML = '';}}</script>
</div>
</div>
<p>&nbsp;</p>
<p><span style="color:green;"><strong>Q9.15</strong></span> Of the participants who have a clerical occupation, how many were over 50 years old at the time of the data collection?</p>
<div class="cell">
<div class="cell-output-display">
<form name="form_59927" onsubmit="return validate_form_59927()" method="post">
<label>
<input type="radio" name="answer_59927" id="answer_59927_1" value="none">
none
</label>
<br>
<label>
<input type="radio" name="answer_59927" id="answer_59927_2" value="1">
1
</label>
<br>
<label>
<input type="radio" name="answer_59927" id="answer_59927_3" value="2">
2
</label>
<br>
<label>
<input type="radio" name="answer_59927" id="answer_59927_4" value="6">
6
</label>
<br>
<label>
<input type="radio" name="answer_59927" id="answer_59927_5" value="all of them">
all of them
</label>
<br>
<input type="submit" value="Check answer">
<div id="result_59927"></div>
</form>
<script>function validate_form_59927() {var x, text; var x = document.forms['form_59927']['answer_59927'].value;if (x == '6'){text = 'That’s right! Check the solution below to see different ways to find the answer to this question. 😎';} else {text = 'That’s not the correct answer. Check the hint below.';} document.getElementById('result_59927').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){
         element = document.getElementById('checkdown_final_score');
         if(element === null){return false;} else {var element, text, res1, res2, res3, res4, res5, res6, res7, res8, res9, res10, res11, res12, res13, res14, res15;res1 = document.getElementById('result_70985').innerText == 'That’s right!'; res2 = document.getElementById('result_25731').innerText == 'Correct, well done!'; res3 = document.getElementById('result_18811').innerText == 'That’s right!'; res4 = document.getElementById('result_66635').innerText == 'That’s right.'; res5 = document.getElementById('result_4220').innerText == 'Your intuition is correct (and this is confirmed by the author in the description of the L2 participants in the published paper).'; res6 = document.getElementById('result_25248').innerText == 'That’s right, well done! This trailing space needs to be removed otherwise R (and most other data analysis programmes) will consider this value to represent a fifth occupational category.'; res7 = document.getElementById('result_11643').innerText == 'That’s right! Now, use str_trim() to remove all trailing spaces in the OccupGroup variable. Check that you then have an L1 dataset with only four occupational categories.'; res8 = document.getElementById('result_51193').innerText == 'That’s right, well done!'; res9 = document.getElementById('result_64746').innerText == '✅ That’s right, well done!'; res10 = document.getElementById('result_53435').innerText == '✅ Très bien! ¡Muy bien hecho! Ottimo!'; res11 = document.getElementById('result_72712').innerText == '✅ Yes, nice data wrangling job!'; res12 = document.getElementById('result_90939').innerText == '✅  Nice work!'; res13 = document.getElementById('result_32227').innerText == 'Perfect! 🎉'; res14 = document.getElementById('result_60086').innerText == '✅'; res15 = document.getElementById('result_59927').innerText == 'That’s right! Check the solution below to see different ways to find the answer to this question. 😎';text = res1 + res2 + res3 + res4 + res5 + res6 + res7 + res8 + res9 + res10 + res11 + res12 + res13 + res14 + res15;element.innerHTML = text;
         return false;
         }}</script>
</div>
<div class="cell-output-display">
<div id="hint_42870" onclick="return show_hint_42870()">🐭 Click on the mouse for a hint.</div>
<div id="result_42870" onclick="return show_hint_42870()"></div>
<script>function show_hint_42870(){var x = document.getElementById('result_42870').innerHTML; if(!x){document.getElementById('result_42870').innerHTML = 'One way to answer find the answer to this question is to cross-tabulate the <code>Age</code> and <code>OccupGroup</code> variables of <code>combined.data</code> using the count() function and then add up the numbers in your head. Check the solution below if you’re stuck.';} else {document.getElementById('result_42870').innerHTML = '';}}</script>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click here to see the <code>R</code> code necessary to answer <span style="color:green;"><strong>Q9.15</strong></span>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>There are various ways to find the answer to Q5. Sticking to a function that we have looked at so far, you could cross-tabulate <code>Age</code> and <code>OccupGroup</code> using the <code>count()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>combined.data <span class="sc">|&gt;</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(OccupGroup, Age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>   OccupGroup Age n
1           C  20 1
2           C  25 6
3           C  27 2
4           C  28 3
5           C  29 4
6           C  30 3
7           C  32 3
8           C  37 1
9           C  38 1
10          C  39 1
11          C  41 1
12          C  51 2
13          C  52 1
14          C  53 1
15          C  57 1
16          C  60 1</code></pre>
</div>
</div>
<p>And then add up the frequencies listed in the rows that correspond to participants with clerical jobs who are 50.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span><span class="dv">1</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 6</code></pre>
</div>
</div>
<p>But, of course, this is method is rather error-prone! Instead, we can use <code>dplyr::filter()</code> (see <a href="#fig-filter" class="quarto-xref">Figure&nbsp;<span>9.11</span></a>) to filter the combined dataset according to our two criteria of interest and then count the number of rows (i.e., participants) remaining in the dataset once the filter has been applied.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>combined.data <span class="sc">|&gt;</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(OccupGroup <span class="sc">==</span> <span class="st">"C"</span> <span class="sc">&amp;</span> Age <span class="sc">&gt;</span> <span class="dv">50</span>) <span class="sc">|&gt;</span> </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 6</code></pre>
</div>
</div>
<div id="fig-filter" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Cartoon showing three fuzzy monsters either selecting or crossing out rows of a data table. If the type of animal in the table is “otter” and the site is “bay”, a monster is drawing a purple rectangle around the row. If those conditions are not met, another monster is putting a line through the column indicating it will be excluded. Stylized text reads “dplyr::filter() - keep rows that satisfy your conditions.”">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-filter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/AHorst_filter.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15" title="Figure&nbsp;9.11: Artwork explaining the dplyr::filter() function by @allison_horst."><img src="images/AHorst_filter.png" class="img-fluid figure-img" alt="Cartoon showing three fuzzy monsters either selecting or crossing out rows of a data table. If the type of animal in the table is “otter” and the site is “bay”, a monster is drawing a purple rectangle around the row. If those conditions are not met, another monster is putting a line through the column indicating it will be excluded. Stylized text reads “dplyr::filter() - keep rows that satisfy your conditions.”"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-filter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.11: Artwork explaining the <code>dplyr::filter()</code> function by <a href="https://allisonhorst.com/allison-horst">@allison_horst</a>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="sec-ExportingRObjects" class="level2" data-number="9.9">
<h2 data-number="9.9" class="anchored" data-anchor-id="sec-ExportingRObjects"><span class="header-section-number">9.9</span> Saving and exporting <code>R</code> objects</h2>
<p>As a final step, we want to save the <code>R</code> object <code>combined.data</code> to a local file on our computer so that, when we continue our analyses in a new <code>R</code> session, we can immediately start working with the wrangled dataset. We can either save the wrangled dataset as an <code>R</code> object (<code>.rds</code>) or export it as a DSV file (e.g.&nbsp;<code>.csv</code>, see <a href="2_Data.html#sec-DSV" class="quarto-xref"><span>Section 2.5.1</span></a>). The pros and cons of the two solutions are summarised in <a href="#tbl-saving" class="quarto-xref">Table&nbsp;<span>9.1</span></a>.</p>
<div id="tbl-saving" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-saving-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;9.1: Pros and cons of saving DSV and <code>R</code> data files.
</figcaption>
<div aria-describedby="tbl-saving-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 41%">
<col style="width: 58%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DSV files (e.g., <code>.csv</code>, <code>.tsv</code>, <code>.tab</code>)</th>
<th style="text-align: left;"><code>R</code> data files (<code>.rds</code>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">✅ Highly portable (i.e., can be opened in all standard spreadsheet software and text editors).</td>
<td style="text-align: left;">❌ Specific to <code>R</code> and cannot be opened in standard spreadsheet software or text editors.</td>
</tr>
<tr class="even">
<td style="text-align: left;">❌ Inefficient for very large datasets.</td>
<td style="text-align: left;">✅ Efficient memory usage for more compact data storage and faster loading times in <code>R</code>.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">✅ Universal, language-independent format and therefore suitable for long-term archiving.</td>
<td style="text-align: left;">❌ No guarantee that older <code>.rds</code> files will be compatible with newer versions of <code>R</code> and therefore unsuitable for long-term archiving.</td>
</tr>
<tr class="even">
<td style="text-align: left;">❌ Loss of metadata.</td>
<td style="text-align: left;">✅ Preserve <code>R</code> data structures (e.g., factor variables remain stored as factors).</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>We will save both a <code>.csv</code> and an <code>.rds</code> version of the wrangled data but in the following chapters, we will use the <code>.rds</code> file.</p>
<p>We will save both files to a subfolder of our project “data” folder called “processed”. If we try to save the file to this subfolder before it has been created at this location we get an error message.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(combined.data, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"processed"</span>, <span class="st">"combined_L1_L2_data.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre data-code-line-numbers=""><code>Error in gzfile(file, mode) : cannot open the connection</code></pre>
<p>We first need to create the “processed” subfolder before we can save to this location! There are two ways of doing this:</p>
<ol type="1">
<li><p>Either in the Files pane of <em>RStudio</em> or in a File Navigator/Explorer window, navigate to the “data” folder and, from there, click on the “Create a new folder” icon to create a new subfolder called “processed”.</p></li>
<li><p>Alternatively, we can use the <code>dir.create()</code> function to create the subfolder from <code>R</code> itself. If the folder already exists at this location, we will get a warning.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb104" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"processed"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that the subfolder exists, we can save <code>combined.data</code> as an <code>.rds</code> file. We will work with this file in the following chapters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(combined.data, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"processed"</span>, <span class="st">"combined_L1_L2_data.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want to share your wrangled dataset with a colleague who does not (yet? 😉) use <code>R</code>, you can use the tidyverse function <code>write_csv()</code>.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> Your colleague will be able to open this file in any standard spreadsheet programme or text editor (but do warn them about the dangers of opening <code>.csv</code> file in spreadsheets, see <a href="2_Data.html#sec-ExcelWarning" class="quarto-xref"><span>Section 2.6</span></a>!).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(combined.data, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"processed"</span>, <span class="st">"combined_L1_L2_data.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-your-progress" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="check-your-progress">Check your progress 🌟</h2>
<p>You have successfully completed <span style="color:green;"><span id="checkdown_final_score">0</span> out of 15 questions</span> in this chapter.</p>
<p>That was a lot of data wrangling, but we are now ready to proceed with some comparative analyses of L1 and L2 English speakers’ language skills!</p>
<p>Are you confident that you can…?</p>
<ul class="task-list">
<li><label><input type="checkbox">Define tidy data (<a href="#sec-tidyverse" class="quarto-xref"><span>Section 9.1</span></a>)</label></li>
<li><label><input type="checkbox">Check the sanity of a dataset (<a href="#sec-Sanity" class="quarto-xref"><span>Section 9.3</span></a>)</label></li>
<li><label><input type="checkbox">Convert character vectors representing categorical data to factors (<a href="#sec-Factors" class="quarto-xref"><span>Section 9.3.2</span></a>)</label></li>
<li><label><input type="checkbox">Add and replace columns in a table (<a href="#sec-mutate" class="quarto-xref"><span>Section 9.4.1</span></a>)</label></li>
<li><label><input type="checkbox">Transform several columns at once (<a href="#sec-across" class="quarto-xref"><span>Section 9.4.2</span></a>)</label></li>
<li><label><input type="checkbox">Use {stringr} functions to manipulate text values (<a href="#sec-stringR" class="quarto-xref"><span>Section 9.5.1</span></a>)</label></li>
<li><label><input type="checkbox">Interpret <code>R</code> package cheatsheets</label></li>
<li><label><input type="checkbox">Gain insights from the help file of <code>R</code> functions</label></li>
<li><label><input type="checkbox">Use tidyverse functions to pre-process data in an readable and reproducible way (<a href="#sec-Preprocessing" class="quarto-xref"><span>Section 9.4</span></a>) and (<a href="#sec-filter" class="quarto-xref"><span>Section 9.8</span></a>)</label></li>
<li><label><input type="checkbox">Save <code>R</code> objects as <code>.rds</code> and <code>.csv</code> files on your computer (<a href="#sec-ExportingRObjects" class="quarto-xref"><span>Section 9.9</span></a>)</label></li>
</ul>
<p>The <a href="@sec-DataViz">following chapter</a> stays in the tidyverse as we will learn how to use the popular tidyverse package {ggplot2} to visualise the pre-processed data from <span class="citation" data-cites="DabrowskaExperienceAptitudeIndividual2019">Dąbrowska (<a href="99_references.html#ref-DabrowskaExperienceAptitudeIndividual2019" role="doc-biblioref">2019</a>)</span>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-DabrowskaExperienceAptitudeIndividual2019" class="csl-entry" role="listitem">
Dąbrowska, Ewa. 2019. Experience, aptitude, and individual differences in linguistic attainment: A comparison of native and nonnative speakers. <em>Language Learning</em> 69(S1). 72–100. <a href="https://doi.org/10.1111/lang.12323">https://doi.org/10.1111/lang.12323</a>.
</div>
<div id="ref-horstOpenscapesTidyData2020" class="csl-entry" role="listitem">
Horst, Allison &amp; Julie Lowndes. 2020. Openscapes - tidy data for efficiency, reproducibility, and collaboration. <a href="https://openscapes.org/blog/2020-10-12-tidy-data/">https://openscapes.org/blog/2020-10-12-tidy-data/</a>.
</div>
<div id="ref-TidyMessyData" class="csl-entry" role="listitem">
Wickham, Hadley, Davis Vaughan &amp; Maximilian Girlich. Tidy messy data. <a href="https://tidyr.tidyverse.org/">https://tidyr.tidyverse.org/</a>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Note that, throughout this chapter, long code output is shortened to save space. When you run this command on your own computer, however, you will see that the output is much longer that what is reprinted in this chapter. You will likely need to scroll up in your Console window to view it all.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The equivalent base <code>R</code> function is <code>toupper()</code>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>We could also use the <code>full_join()</code> function since we want to retain all rows and all columns from both datasets.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Alternatively, you may have gathered from the cheatsheet (<a href="#fig-dplyrcheatsheet" class="quarto-xref">Figure&nbsp;<span>9.8</span></a>) that the <code>bind_rows()</code> function has an optional “.id” argument that can be used to create an additional column to disambiguate between the two combined datasets. In this case, we do not need to add a <code>Group</code> column to both datasets prior to combining them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>combined.data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="at">L1 =</span> L1.data, </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">L2 =</span> L2.data, </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">.id =</span> <span class="st">"Group"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></li>
<li id="fn5"><p>As usual, there is a base <code>R</code> alternative: <code>write.csv()</code> will work just as well but, for larger datasets, it is considerably slower than <code>write_csv()</code>. For finer differences, check out the functions’ respective help files.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    window.setColorSchemeToggle(window.hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/elenlefoll\.github\.io\/RstatsTexbook\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./8_DescriptiveStats.html" class="pagination-link" aria-label="Desc`R`iptive statistics">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Desc<code>R</code>iptive statistics</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./10_Dataviz.html" class="pagination-link" aria-label="The Gramma`R` of Graphics">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The Gramma<code>R</code> of Graphics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://www.elenlefoll.eu">Elen Le Foll</a></p>
</div>   
    <div class="nav-footer-center">
<p>Data Analysis for the Language Sciences</p>
</div>
    <div class="nav-footer-right">
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA</a></p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




<script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>